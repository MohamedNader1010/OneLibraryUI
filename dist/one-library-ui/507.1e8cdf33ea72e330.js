"use strict";(self.webpackChunkOneLibraryUI=self.webpackChunkOneLibraryUI||[]).push([[507],{2507:(Ie,f,n)=>{n.r(f),n.d(f,{OrderFormDialogComponent:()=>m});var v=n(5861),u=n(4006),I=n(1135),T=n(4128),Z=n(262),y=n(9646),x=n(4004),E=n(8675),d=n(5316),P=n(5285),g=n(5412),S=n(3120),F=n(9017),N=n(6911),e=n(4650),M=n(7843),U=n(4467),q=n(9198),Q=n(9648),L=n(8653),O=n(9383),J=n(1809),w=n(7185),D=n(6895),Y=n(5810),h=n(9549),V=n(7392),K=n(4144),b=n(1948),R=n(4385),W=n(3238),A=n(4859);function B(i,r){1&i&&(e.TgZ(0,"h4",31),e._uU(1," \u064a\u0645\u0643\u0646\u0643 \u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u062d\u0627\u0644\u0629 \u0627\u0644\u062e\u0627\u0635\u0629 \u0628\u0643\u0644 \u0628\u0646\u062f \u0641\u064a \u0627\u0644\u0637\u0644\u0628 \u0641\u0642\u0637. "),e.qZA())}function j(i,r){1&i&&(e.TgZ(0,"h4",31),e._uU(1," \u0647\u0630\u0627 \u0627\u0644\u0637\u0644\u0628 \u0645\u0643\u062a\u0645\u0644 \u063a\u064a\u0631 \u0645\u0633\u0645\u0648\u062d \u0628\u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a "),e.qZA())}function G(i,r){if(1&i&&(e.ynx(0),e.TgZ(1,"h2",28),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,B,2,0,"h4",29),e.YNc(5,j,2,0,"ng-template",null,30,e.W1O),e.BQk()),2&i){const t=e.MAs(6),a=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,3,"order.edit")),e.xp6(2),e.Q6J("ngIf",6!=a.data.orderStatus)("ngIfElse",t)}}function H(i,r){1&i&&(e.TgZ(0,"h2",28),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"order.new")))}function k(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"autocomplete",32),e.NdJ("selectedId",function(o){e.CHM(t);const s=e.oxw();return e.KtG(s.setClientTypeId(o))}),e.ALo(1,"translate"),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("label",e.lcZ(1,2,"shared.clientType"))("dataSource",t.ClientTypesDataSource)}}function X(i,r){if(1&i&&(e.TgZ(0,"mat-form-field",33)(1,"mat-label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e._UZ(4,"input",34),e.qZA()),2&i){const t=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,3,"shared.clientType")),e.xp6(2),e.Q6J("value",t.data.clientTypeName)("readonly",!0)}}function $(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"autocomplete",35),e.NdJ("selectedId",function(o){e.CHM(t);const s=e.oxw();return e.KtG(s.setClientId(o))}),e.ALo(1,"translate"),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("label",e.lcZ(1,4,"shared.client"))("dataSource",t.ClientsDataSource)("clear",t.clearAutocomplete)("selectedValue",t.selectedClientId)}}function z(i,r){if(1&i&&(e.TgZ(0,"mat-form-field",36)(1,"mat-label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e._UZ(4,"input",34),e.qZA()),2&i){const t=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,3,"shared.client")),e.xp6(2),e.Q6J("value",t.data.clientName)("readonly",!0)}}function ee(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",37),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.handleNewDetail())}),e.TgZ(1,"mat-icon"),e._uU(2,"add"),e.qZA()()}if(2&i){const t=e.oxw();e.Q6J("disabled",!t.clientId.value||t.clientId.invalid)}}function te(i,r){1&i&&(e.TgZ(0,"div",4)(1,"label",53),e._uU(2,"\u0623\u062e\u062a\u0631 \u062e\u062f\u0645\u0629 \u0627\u0648 \u0645\u0630\u0643\u0631\u0629"),e.qZA(),e.TgZ(3,"mat-radio-group",54)(4,"mat-radio-button",55),e._uU(5,"\u062e\u062f\u0645\u0627\u062a"),e.qZA(),e.TgZ(6,"mat-radio-button",56),e._uU(7,"\u0645\u0630\u0643\u0631\u0627\u062a"),e.qZA()()())}function re(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"autocomplete",59),e.NdJ("selectedId",function(o){e.CHM(t);const s=e.oxw(2).index,c=e.oxw(2);return e.KtG(c.setServiceId(s,o))}),e.ALo(1,"translate"),e.qZA()}if(2&i){const t=e.oxw(2).index,a=e.oxw(2);e.Q6J("label",e.lcZ(1,4,"shared.service"))("dataSource",a.ServicesDataSource)("clear",a.clearAutocomplete)("selectedValue",a.getServiceId(t).value)}}function ie(i,r){if(1&i&&(e.TgZ(0,"mat-form-field",13)(1,"mat-label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e._UZ(4,"input",34),e.qZA()),2&i){const t=e.oxw(2).index,a=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,3,"service.name")),e.xp6(2),e.Q6J("value",a.getOrderDetailService(t).value)("readonly",!0)}}function ae(i,r){if(1&i&&(e.ynx(0),e.YNc(1,re,2,6,"autocomplete",57),e.YNc(2,ie,5,5,"ng-template",null,58,e.W1O),e.BQk()),2&i){const t=e.MAs(3),a=e.oxw(3);e.xp6(1),e.Q6J("ngIf",!a.data)("ngIfElse",t)}}function oe(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"autocomplete",62),e.NdJ("selectedId",function(o){e.CHM(t);const s=e.oxw(2).index,c=e.oxw(2);return e.KtG(c.setNoteId(s,o))}),e.ALo(1,"translate"),e.qZA()}if(2&i){const t=e.oxw(2).index,a=e.oxw(2);e.Q6J("label",e.lcZ(1,4,"shared.note"))("dataSource",a.NotesDataSource)("clear",a.clearAutocomplete)("selectedValue",a.getNoteId(t).value)}}function le(i,r){if(1&i&&(e.TgZ(0,"mat-form-field",13)(1,"mat-label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e._UZ(4,"input",34),e.qZA()),2&i){const t=e.oxw(2).index,a=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,3,"note.name")),e.xp6(2),e.Q6J("value",a.getOrderDetailNote(t).value)("readonly",!0)}}function ne(i,r){if(1&i&&(e.ynx(0),e.YNc(1,oe,2,6,"autocomplete",60),e.YNc(2,le,5,5,"ng-template",null,61,e.W1O),e.BQk()),2&i){const t=e.MAs(3),a=e.oxw(3);e.xp6(1),e.Q6J("ngIf",!a.data)("ngIfElse",t)}}function se(i,r){1&i&&(e.TgZ(0,"mat-form-field",63)(1,"mat-label"),e._uU(2,"\u0627\u0644\u0639\u062f\u062f"),e.qZA(),e._UZ(3,"input",64),e.qZA())}function ue(i,r){1&i&&(e.TgZ(0,"mat-form-field",63)(1,"mat-label"),e._uU(2,"\u0627\u0644\u0646\u0633\u062e"),e.qZA(),e._UZ(3,"input",65),e.qZA())}function ce(i,r){if(1&i&&(e.TgZ(0,"mat-error"),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;let a;e.xp6(1),e.hij(' \u0644\u0627 \u064a\u0645\u0643\u0646 \u0627\u0644\u0627\u0633\u062a\u0644\u0627\u0645 \u0648\u0644\u0627 \u062a\u0648\u062c\u062f \u0643\u0645\u064a\u0647 \u0643\u0627\u0641\u064a\u0647 "',null==(a=t.get("quantity"))||null==a.errors?null:a.errors.exceedQuantity.availableQuantity,'" ')}}function de(i,r){if(1&i&&(e.TgZ(0,"mat-option",66),e._uU(1),e.qZA()),2&i){const t=r.$implicit,a=e.oxw(3);e.Q6J("value",t),e.xp6(1),e.hij(" ",a.StatusInstance[t]," ")}}function _e(i,r){1&i&&(e.TgZ(0,"mat-error"),e._uU(1," \u064a\u062c\u0628 \u0627\u062e\u062a\u064a\u0627\u0631 \u062d\u0627\u0644\u0629 \u0627\u0644\u0637\u0644\u0628 "),e.qZA())}function me(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",67),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().index,s=e.oxw(2);return e.KtG(s.handleDeleteDetail(o))}),e.TgZ(1,"mat-icon"),e._uU(2,"delete"),e.qZA()()}}function pe(i,r){if(1&i&&(e.TgZ(0,"div",4)(1,"div",40),e.YNc(2,te,8,0,"div",41),e.TgZ(3,"div",4)(4,"div",17),e.YNc(5,ae,4,2,"ng-container",16),e.YNc(6,ne,4,2,"ng-container",16),e.qZA(),e.TgZ(7,"div",42),e.YNc(8,se,4,0,"mat-form-field",43),e.YNc(9,ue,4,0,"mat-form-field",43),e.TgZ(10,"mat-form-field",44)(11,"mat-label"),e._uU(12),e.ALo(13,"translate"),e.qZA(),e._UZ(14,"input",45),e.qZA(),e.TgZ(15,"div"),e.YNc(16,ce,2,1,"mat-error",16),e.qZA(),e.TgZ(17,"mat-form-field",46)(18,"mat-label"),e._uU(19),e.ALo(20,"translate"),e.qZA(),e._UZ(21,"input",47,48),e.qZA()(),e.TgZ(23,"div",17)(24,"mat-form-field",49)(25,"mat-label"),e._uU(26),e.ALo(27,"translate"),e.qZA(),e.TgZ(28,"mat-select",50),e.YNc(29,de,2,2,"mat-option",51),e.qZA(),e.YNc(30,_e,2,0,"mat-error",16),e.qZA()(),e.TgZ(31,"div",9),e.YNc(32,me,3,0,"button",52),e.qZA()()()()),2&i){const t=r.$implicit,a=r.index,o=e.oxw(2);let s,c;e.xp6(1),e.Q6J("formGroupName",a),e.xp6(1),e.Q6J("ngIf",!o.data),e.xp6(3),e.Q6J("ngIf","service"==o.getNoteOrService(a).value),e.xp6(1),e.Q6J("ngIf","note"==o.getNoteOrService(a).value),e.xp6(2),e.Q6J("ngIf",o.isServiceSelected(a)&&!o.data),e.xp6(1),e.Q6J("ngIf",o.isServiceSelected(a)&&!o.data),e.xp6(1),e.Tol(o.isServiceSelected(a)&&!o.data?"w-23":"w-48"),e.xp6(2),e.Oqu(e.lcZ(13,19,"quantity.label")),e.xp6(2),e.Q6J("readonly",o.isServiceSelected(a)||!!o.data),e.xp6(2),e.Q6J("ngIf",null==(s=t.get("quantity"))?null:s.hasError("exceedQuantity")),e.xp6(1),e.Tol(o.isServiceSelected(a)&&!o.data?"w-23":"w-48"),e.xp6(2),e.Oqu(e.lcZ(20,21,"shared.price")),e.xp6(2),e.Q6J("readonly",!0),e.xp6(5),e.Oqu(e.lcZ(27,23,"order.status")),e.xp6(3),e.Q6J("ngForOf",o.getAvailableStatus(a)),e.xp6(1),e.Q6J("ngIf",null==(c=t.get("orderStatus"))?null:c.hasError("required")),e.xp6(2),e.Q6J("ngIf",!o.data)}}function ge(i,r){if(1&i&&(e.TgZ(0,"div",38),e.YNc(1,pe,33,25,"div",39),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.OrderDetails.controls)}}function he(i,r){1&i&&(e.TgZ(0,"mat-error"),e._uU(1," \u064a\u062c\u0628 \u0627\u0646 \u064a\u0643\u0648\u0646 \u0627\u0644\u0645\u0628\u0644\u063a \u0627\u0643\u0628\u0631 \u0645\u0646 \u0627\u0648 \u064a\u0633\u0627\u0648\u064a 0 "),e.qZA())}function fe(i,r){1&i&&(e.TgZ(0,"mat-error"),e._uU(1," \u064a\u062c\u0628 \u0627\u0646 \u062a\u0643\u0648\u0646 \u0627\u0644\u0646\u0633\u0628\u0629 \u0627\u0643\u0628\u0631 \u0645\u0646 \u0627\u0648 \u064a\u0633\u0627\u0648\u064a 0 "),e.qZA())}function ve(i,r){1&i&&(e.TgZ(0,"mat-error"),e._uU(1," \u064a\u062c\u0628 \u0627\u0646 \u064a\u0643\u0648\u0646 \u0627\u0644\u0645\u0628\u0644\u063a \u0627\u0644\u0645\u062f\u0641\u0648\u0639 \u0627\u0643\u0628\u0631 \u0645\u0646 0 "),e.qZA())}function Oe(i,r){1&i&&(e.TgZ(0,"mat-error"),e._uU(1," \u0644\u0627 \u064a\u0645\u0643\u0646 \u0627\u0646 \u064a\u0643\u0648\u0646 \u0627\u0644\u0645\u0628\u0644\u063a \u0627\u0644\u0645\u062a\u0628\u0642\u064a \u0627\u0642\u0644 \u0645\u0646 0 "),e.qZA())}class m extends P.r{constructor(r,t,a,o,s,c,_,De,be,Ae,Ce,C){super(be,_,a,C),this._service=r,this._note=t,this._order=a,this._client=o,this._clientType=s,this.fb=c,this.data=De,this._servicePrice=Ae,this.dialog=Ce,this.toastr=C,this.availableStatus=[d.q.\u0627\u0633\u062a\u0644\u0645,d.q.\u062d\u062c\u0632,d.q.\u0627\u0639\u062f\u0627\u062f,d.q.\u062c\u0627\u0647\u0632,d.q.\u0645\u0631\u062a\u062c\u0639,d.q.\u0647\u0627\u0644\u0643],this.StatusInstance=d.q,this.ServicesDataSource=[],this.NotesDataSource=[],this.ClientsDataSource=[],this.ClientTypesDataSource=[],this.clearAutocomplete=new I.X(0),this.getOrderDetailId=l=>this.OrderDetails.at(l).get("id"),this.getNoteOrService=l=>this.OrderDetails.at(l)?.get("noteOrService"),this.getOrderDetailServiceId=l=>this.OrderDetails.at(l).get("serviceId"),this.getOrderDetailService=l=>this.OrderDetails.at(l).get("service"),this.getOrderDetailNoteId=l=>this.OrderDetails.at(l).get("noteId"),this.getOrderDetailNote=l=>this.OrderDetails.at(l).get("note"),this.getOrderDetailQuantity=l=>this.OrderDetails.at(l).get("quantity"),this.getOrderDetailPrice=l=>this.OrderDetails.at(l).get("price"),this.getOrderDetailStatus=l=>this.OrderDetails.at(l).get("orderStatus"),this.getServiceId=l=>this.OrderDetails.at(l).get("serviceId"),this.getNoteId=l=>this.OrderDetails.at(l).get("noteId"),this.getCountControl=l=>this.OrderDetails.at(l).get("counts"),this.getCopiesControl=l=>this.OrderDetails.at(l).get("copies"),this.getQuantityControl=l=>this.OrderDetails.at(l).get("quantity"),this.setClientTypeId=l=>this.clientTypeId.setValue(l),this.setServiceId=(l,p)=>this.OrderDetails.at(l).get("serviceId")?.setValue(p),this.setNoteId=(l,p)=>this.OrderDetails.at(l).get("noteId")?.setValue(p),this.patchData=()=>{this.data.orderDetails.forEach(l=>{let p=this.data.orderDetails.indexOf(l);this.OrderDetails.push(this.createFormItem("detail")),this.getNoteOrService(p).setValue(l.noteId?"note":"service")}),this.Form.patchValue(this.data)},this.handleNewDetail=()=>{let l=this.OrderDetails.length;this.OrderDetails.push(this.createFormItem("detail")),this.subscribeQuantityChanges(l),this.subscribeServiceChanges(l),this.subscribeNoteChanges(l),this.subscribeCopiesChanges(l),this.subscribeCountChanges(l),this.subscribeOrderStatusChangesByiIndex(l)},this.handleDeleteDetail=l=>{this.OrderDetails.removeAt(l),this.OrderDetails.length?this.calculateTotalPrice():this.ResetcalculateTotal_Final_Rest()},this.Form=this.createFormItem("init")}get clientId(){return this.Form.get("clientId")}get clientTypeId(){return this.Form.get("clientTypeId")}get OrderDetails(){return this.Form.get("orderDetails")}get totalPrice(){return this.Form.get("totalPrice")}get finalPrice(){return this.Form.get("finalPrice")}get rest(){return this.Form.get("rest")}get paid(){return this.Form.get("paid")}get discount(){return this.Form.get("discount")}get discountPercent(){return this.Form.get("discountPercent")}setClientId(r){var t=this;return(0,v.Z)(function*(){-1===r?yield t.HandleNewClient():t.clientId.setValue(r)})()}ngOnInit(){this.matDialogRef.disableClose=!0,this.data?(this.patchData(),this.subscribeOrderStatusChanges()):this.forkJoins()}getAvailableStatus(r){return this.data?this.availableStatus.filter(t=>t>=this.getOrderDetailStatus(r).value):this.availableStatus}forkJoins(){let r=[this._note.getAll(),this._clientType.getAll(),this._service.getAll()];return(0,T.D)(r).pipe((0,Z.K)(t=>(0,y.of)(t)),(0,x.U)(([t,a,o])=>({notes:t,clientsType:a,services:o}))).subscribe({next:t=>{this.NotesDataSource=t.notes.body,this.ServicesDataSource=t.services.body,this.ClientTypesDataSource=t.clientsType.body},complete:()=>{this.subscribeClientTypeChange(),this.subscribeFormMoneyChanges()}})}subscribeFormMoneyChanges(){this.Form.valueChanges.subscribe(r=>{const t=r.discount,a=r.discountPercent,o=r.totalPrice,s=r.paid;if(null!==t){const c=o-t,_=0==t?0:+(t/o*100).toFixed(2);this.Form.patchValue({finalPrice:c,discountPercent:_,rest:c-this.paid.value},{emitEvent:!1})}else if(null!==a){const c=a/100*o,_=o-c;this.Form.patchValue({finalPrice:_,discount:c,rest:_-this.paid.value},{emitEvent:!1})}else if(null!==o){const c=o-t==0?0:+((o-t)/o*100).toFixed(2);this.Form.patchValue({discountPercent:c},{emitEvent:!1})}else null!==s&&this.rest.setValue(+this.finalPrice.value-s,{emitEvent:!1})})}createFormItem(r){let t=this.fb.group({});switch(r){case"init":t=this.fb.group({id:[0],totalPrice:[0],finalPrice:[0],discount:[0,[u.kI.min(0)]],discountPercent:[0,[u.kI.min(0)]],rest:[0,[u.kI.required,u.kI.min(0)]],paid:[0,[u.kI.required,u.kI.min(0)]],clientId:[null,[u.kI.required]],clientTypeId:[null],orderDetails:this.fb.array([]),remarks:[null]});break;case"detail":t=this.fb.group({id:[0],noteOrService:["service"],price:[0],quantity:[0,[u.kI.required],[N.Hm]],serviceId:[null],service:[""],noteId:[null],note:[""],availableNoteQuantity:[""],orderStatus:[null,[u.kI.required]],counts:[1],copies:[1]})}return t}subscribeOrderStatusChangesByiIndex(r){this.subscriptions.push(this.getOrderDetailStatus(r).valueChanges.subscribe(t=>{if(t==d.q.\u0627\u0633\u062a\u0644\u0645){const a=this.getNoteId(r).value,o=this.NotesDataSource.find(s=>s.id==a)?.quantity;this.setAvailableQuantity(r,o??0)}else this.getQuantityControl(r).updateValueAndValidity()}))}subscribeOrderStatusChanges(){this.OrderDetails.controls.forEach((r,t)=>{r.get("orderStatus")?.valueChanges.subscribe(a=>{const o=r.get("noteId")?.value;this._note.GetById(o).subscribe(s=>{this.setAvailableQuantity(t,s.body.quantity??0)})})})}subscribeQuantityChanges(r){this.subscriptions.push(this.getOrderDetailQuantity(r).valueChanges.subscribe(()=>{this.calculateTotalPrice()}))}subscribeCountChanges(r){this.subscriptions.push(this.getCountControl(r).valueChanges.subscribe(t=>{const a=+this.getCopiesControl(r).value*t;this.getOrderDetailQuantity(r).setValue(a)}))}subscribeCopiesChanges(r){this.subscriptions.push(this.getCopiesControl(r).valueChanges.subscribe(t=>{const a=+this.getCountControl(r).value*t;this.getOrderDetailQuantity(r).setValue(a)}))}subscribeServiceChanges(r){this.subscriptions.push(this.getOrderDetailServiceId(r).valueChanges.subscribe({next:()=>this.setServicePriceForClientType(r)}))}setServicePriceForClientType(r){this.subscriptions.push(this._servicePrice.getPrice(this.clientTypeId.value,this.getOrderDetailServiceId(r).value).subscribe({next:t=>{if(!t.body)return this.toastr.error("\u0647\u0630\u0647 \u0627\u0644\u062e\u062f\u0645\u0629 \u063a\u064a\u0631 \u0645\u0633\u0639\u0631\u0629"),void this.getOrderDetailPrice(r).setValue(0);this.getOrderDetailPrice(r).setValue(t.body.price)},error:t=>{this.isSubmitting=!1,this.getOrderDetailPrice(r).setValue(0)},complete:()=>{this.calculateTotalPrice()}}))}subscribeClientTypeChange(){this.subscriptions.push(this.clientTypeId.valueChanges.pipe((0,E.O)(null)).subscribe(r=>{null!=r&&this.subscriptions.push(this._client.getAllByType(r).subscribe({next:t=>{this.ClientsDataSource=[{id:-1,name:"\u0623\u0636\u0627\u0641\u0629 \u0639\u0645\u064a\u0644 \u062c\u062f\u064a\u062f",phoneNumber:"",clientType:"",clientTypeId:-1,paid:"",rest:"",total:""},...t.body],this.clearAutocomplete.next(1)},error:t=>{this.ClientsDataSource=[],this.isSubmitting=!1,this.toastr.error((t.error??t).message)},complete:()=>{this.reloadServicesPrices(),this.calculateTotalPrice()}}))}))}HandleNewClient(){var r=this;return(0,v.Z)(function*(){const t=yield S.f.getAppropriateDialogComponent(F.j.ClientFormDialogComponent),a=r.dialog.open(t,{minWidth:"30%"});r.subscriptions.push(a.afterClosed().subscribe({next:o=>{if(o?.data){let s=o.data.body;r.clearAutocomplete.next(1),r.clientTypeId.value===s.clientTypeId&&(r.ClientsDataSource.push(s),r.selectedClientId=s.id,r.clientId.setValue(r.selectedClientId))}}}))})()}reloadServicesPrices(){for(let r=0;r<this.OrderDetails.controls.length;r++)"note"!==this.getNoteOrService(r).value&&this.setServicePriceForClientType(r)}subscribeNoteChanges(r){this.subscriptions.push(this.getOrderDetailNoteId(r).valueChanges.subscribe({next:t=>{let a=this.NotesDataSource.find(s=>s.id==t)?.finalPrice??0;this.getOrderDetailPrice(r).setValue(a),this.calculateTotalPrice();const o=this.NotesDataSource.find(s=>s.id==t)?.quantity;this.setAvailableQuantity(r,o??0)},error:t=>{this.isSubmitting=!1,this.toastr.error((t.error??t).message),this.getOrderDetailPrice(r).setValue(0)}}))}isServiceSelected(r){return"service"==this.getNoteOrService(r).value}calculateTotalPrice(){let r=0;for(let t=0;t<this.OrderDetails.controls.length;t++)r+=+this.getOrderDetailPrice(t).value*+this.getOrderDetailQuantity(t).value;this.totalPrice.setValue(r)}ResetcalculateTotal_Final_Rest(){this.totalPrice.setValue(0),this.finalPrice.setValue(0),this.discount.setValue(0),this.discountPercent.setValue(0)}handleSubmit(){this.Form.valid&&(this.isSubmitting=!0,this.data?this.subscriptions.push(this._order.updateOrderDetailsStatus(this.Form.value).subscribe({next:r=>{this._order.dialogData=r.body,this.matDialogRef.close({data:r})},error:r=>{this.isSubmitting=!1,this.toastr.error((r.error??r).message)},complete:()=>{this.isSubmitting=!1}})):this.add(this.Form.value))}setAvailableQuantity(r,t){this.getNoteId(r).value&&(this.OrderDetails.at(r).get("availableNoteQuantity")?.setValue(t),this.getQuantityControl(r).updateValueAndValidity())}}m.\u0275fac=function(r){return new(r||m)(e.Y36(M.r),e.Y36(U.Y),e.Y36(q.p),e.Y36(Q.y),e.Y36(L.q),e.Y36(u.qu),e.Y36(O.sK),e.Y36(g.WI),e.Y36(g.so),e.Y36(J.c),e.Y36(g.uw),e.Y36(w._W))},m.\u0275cmp=e.Xpm({type:m,selectors:[["app-order-form-dialog"]],features:[e.qOj],decls:75,vars:50,consts:[[1,"container"],[4,"ngIf","ngIfElse"],["update",""],[1,"d-flex","flex-column",3,"formGroup","ngSubmit"],[1,"row"],["class","col-5",3,"label","dataSource","selectedId",4,"ngIf","ngIfElse"],["clientType",""],["class","col-6",3,"label","dataSource","clear","selectedValue","selectedId",4,"ngIf","ngIfElse"],["client",""],[1,"col-1"],["type","button","mat-icon-button","","matTooltip","add","color","basic","aria-label","add order detail row",3,"disabled","click",4,"ngIf"],["formArrayName","orderDetails",4,"ngIf"],[1,"col-4"],["color","warn",1,"w-100"],["type","number","matInput","","formControlName","totalPrice",3,"readonly"],["type","number","matInput","","formControlName","discount","min","0",3,"readonly"],[4,"ngIf"],[1,"col-3"],["type","number","matInput","","formControlName","discountPercent","min","0",3,"readonly"],["matTextPrefix",""],["type","number","matInput","","formControlName","finalPrice",3,"readonly"],["type","number","matInput","","formControlName","paid",3,"readonly"],["type","number","matInput","","formControlName","rest",3,"readonly"],[1,"col-11"],["matInput","","formControlName","remarks",3,"readonly"],[1,"my-2","d-flex","flex-row-reverse"],["mat-raised-button","","color","warn",1,"mx-2","px-4",3,"disabled"],["type","button","mat-stroked-button","","color","warn",3,"click"],[1,"w-100","text-center","mt-3"],["class","w-100 text-center mt-1 text-secondary",4,"ngIf","ngIfElse"],["complete",""],[1,"w-100","text-center","mt-1","text-secondary"],[1,"col-5",3,"label","dataSource","selectedId"],["color","warn",1,"col-5"],["matInput","",3,"value","readonly"],[1,"col-6",3,"label","dataSource","clear","selectedValue","selectedId"],["color","warn",1,"col-6"],["type","button","mat-icon-button","","matTooltip","add","color","basic","aria-label","add order detail row",3,"disabled","click"],["formArrayName","orderDetails"],["class","row",4,"ngFor","ngForOf"],[3,"formGroupName"],["class","row",4,"ngIf"],[1,"col-5","d-flex","justify-content-between"],["appearance","fill","class","w-23","color","warn",4,"ngIf"],["appearance","fill","color","warn"],["type","number","matInput","","formControlName","quantity","min","1",3,"readonly"],["color","warn"],["type","number","matInput","","formControlName","price",3,"readonly"],["priceRef",""],["appearance","fill","color","warn",1,"w-100"],["formControlName","orderStatus"],[3,"value",4,"ngFor","ngForOf"],["type","button","mat-icon-button","","matTooltip","delete","color","warn","aria-label","delete selected row",3,"click",4,"ngIf"],["id","service-note-raido-group-label"],["formControlName","noteOrService","arialabelledby","service-note-raido-group-label","color","warn"],["value","service"],["value","note"],["class","col-3",3,"label","dataSource","clear","selectedValue","selectedId",4,"ngIf","ngIfElse"],["service",""],[1,"col-3",3,"label","dataSource","clear","selectedValue","selectedId"],["class","col-4",3,"label","dataSource","clear","selectedValue","selectedId",4,"ngIf","ngIfElse"],["note",""],[1,"col-4",3,"label","dataSource","clear","selectedValue","selectedId"],["appearance","fill","color","warn",1,"w-23"],["type","number","formControlName","counts","matInput","","min","1"],["type","number","formControlName","copies","matInput","","min","1"],[3,"value"],["type","button","mat-icon-button","","matTooltip","delete","color","warn","aria-label","delete selected row",3,"click"]],template:function(r,t){if(1&r&&(e.TgZ(0,"div",0),e.YNc(1,G,7,5,"ng-container",1),e.YNc(2,H,3,3,"ng-template",null,2,e.W1O),e.TgZ(4,"mat-dialog-content")(5,"form",3),e.NdJ("ngSubmit",function(){return t.handleSubmit()}),e.TgZ(6,"div",4),e.YNc(7,k,2,4,"autocomplete",5),e.YNc(8,X,5,5,"ng-template",null,6,e.W1O),e.YNc(10,$,2,6,"autocomplete",7),e.YNc(11,z,5,5,"ng-template",null,8,e.W1O),e.TgZ(13,"div",9),e.YNc(14,ee,3,1,"button",10),e.qZA()(),e.YNc(15,ge,2,1,"div",11),e.TgZ(16,"div",4)(17,"div",12)(18,"mat-form-field",13)(19,"mat-label"),e._uU(20),e.ALo(21,"translate"),e.qZA(),e._UZ(22,"input",14),e.qZA()(),e.TgZ(23,"div",12)(24,"mat-form-field",13)(25,"mat-label"),e._uU(26),e.ALo(27,"translate"),e.qZA(),e._UZ(28,"input",15),e.YNc(29,he,2,0,"mat-error",16),e.qZA()(),e.TgZ(30,"div",17)(31,"mat-form-field",13)(32,"mat-label"),e._uU(33),e.ALo(34,"translate"),e.qZA(),e._UZ(35,"input",18),e.TgZ(36,"span",19),e._uU(37,"%"),e.qZA(),e.YNc(38,fe,2,0,"mat-error",16),e.qZA()()(),e.TgZ(39,"div",4)(40,"div",12)(41,"mat-form-field",13)(42,"mat-label"),e._uU(43),e.ALo(44,"translate"),e.qZA(),e._UZ(45,"input",20),e.qZA()(),e.TgZ(46,"div",12)(47,"mat-form-field",13)(48,"mat-label"),e._uU(49),e.ALo(50,"translate"),e.qZA(),e._UZ(51,"input",21),e.YNc(52,ve,2,0,"mat-error",16),e.qZA()(),e.TgZ(53,"div",17)(54,"mat-form-field",13)(55,"mat-label"),e._uU(56),e.ALo(57,"translate"),e.qZA(),e._UZ(58,"input",22),e.YNc(59,Oe,2,0,"mat-error",16),e.qZA()()(),e.TgZ(60,"div",4)(61,"div",23)(62,"mat-form-field",13)(63,"mat-label"),e._uU(64),e.ALo(65,"translate"),e.qZA(),e._UZ(66,"textarea",24),e.qZA()()(),e.TgZ(67,"div",25)(68,"button",26),e._uU(69),e.ALo(70,"translate"),e.ALo(71,"translate"),e.qZA(),e.TgZ(72,"button",27),e.NdJ("click",function(){return t.onNoClick()}),e._uU(73),e.ALo(74,"translate"),e.qZA()()()()()),2&r){const a=e.MAs(3),o=e.MAs(9),s=e.MAs(12);e.xp6(1),e.Q6J("ngIf",t.data)("ngIfElse",a),e.xp6(4),e.Q6J("formGroup",t.Form),e.xp6(2),e.Q6J("ngIf",!t.data)("ngIfElse",o),e.xp6(3),e.Q6J("ngIf",!t.data)("ngIfElse",s),e.xp6(4),e.Q6J("ngIf",!t.data),e.xp6(1),e.Q6J("ngIf",t.OrderDetails.controls.length),e.xp6(5),e.Oqu(e.lcZ(21,30,"shared.totalPrice")),e.xp6(2),e.Q6J("readonly",!0),e.xp6(4),e.Oqu(e.lcZ(27,32,"shared.discountValue")),e.xp6(2),e.Q6J("readonly",t.OrderDetails.controls.length<=0||!!t.data),e.xp6(1),e.Q6J("ngIf",t.discount.invalid&&(t.discount.dirty||t.discount.touched)),e.xp6(4),e.Oqu(e.lcZ(34,34,"shared.discountPercent")),e.xp6(2),e.Q6J("readonly",t.OrderDetails.controls.length<=0||!!t.data),e.xp6(3),e.Q6J("ngIf",t.discountPercent.invalid&&(t.discountPercent.dirty||t.discountPercent.touched)),e.xp6(5),e.Oqu(e.lcZ(44,36,"shared.finalPrice")),e.xp6(2),e.Q6J("readonly",!0),e.xp6(4),e.Oqu(e.lcZ(50,38,"shared.paid")),e.xp6(2),e.Q6J("readonly",t.OrderDetails.controls.length<=0||!!t.data),e.xp6(1),e.Q6J("ngIf",t.paid.invalid&&(t.paid.dirty||t.paid.touched)),e.xp6(4),e.Oqu(e.lcZ(57,40,"shared.rest")),e.xp6(2),e.Q6J("readonly",!0),e.xp6(1),e.Q6J("ngIf",t.rest.invalid&&(t.rest.dirty||t.rest.touched)),e.xp6(5),e.Oqu(e.lcZ(65,42,"shared.clientRemarks")),e.xp6(2),e.Q6J("readonly",!!t.data),e.xp6(2),e.Q6J("disabled",!t.Form.valid||t.isSubmitting),e.xp6(1),e.hij(" ",t.isSubmitting?e.lcZ(70,44,"button.wait"):e.lcZ(71,46,"button.save")," "),e.xp6(4),e.hij(" ",e.lcZ(74,48,"button.back")," ")}},dependencies:[u._Y,u.Fj,u.wV,u.JJ,u.JL,u.qQ,u.sg,u.u,u.x0,u.CE,D.sg,D.O5,Y.Y,g.xY,h.KE,h.hX,h.TO,h.qo,V.Hw,K.Nt,b.VQ,b.U0,R.gD,W.ey,A.lW,A.RK,O.X$],styles:[".container[_ngcontent-%COMP%]{width:1000px}.w-23[_ngcontent-%COMP%]{width:23%!important}.w-48[_ngcontent-%COMP%]{width:48%!important}"]})}}]);