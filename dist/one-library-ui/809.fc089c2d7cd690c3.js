"use strict";(self.webpackChunkOneLibraryUI=self.webpackChunkOneLibraryUI||[]).push([[809],{4809:(Ct,U,a)=>{a.r(U),a.d(U,{OrderModule:()=>_});var q=a(9383),g=a(6895),s=a(4006),F=a(6578),E=a(1697),J=a(7110),M=a(5861),w=a(7957),t=a(4650),d=a(5412);class m{constructor(e){this.dialog=e}canDeactivate(e){var i=this;return(0,M.Z)(function*(){return!!(e.Form.touched&&e.Form.dirty&&e.isSubmitted||e.Form.untouched)||(yield new Promise((o,u)=>{i.dialog.closeAll(),i.dialog.open(w.a,{disableClose:!0,data:{location:"\u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u062a\u0639\u062f\u064a\u0644\u0627\u062a",msg:"\u0644\u0642\u062f \u0642\u0645\u062a \u0628\u062a\u0639\u062f\u064a\u0644 \u0628\u0639\u0636 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a \u0648\u0644\u0645 \u062a\u0642\u0645 \u0628\u062d\u0641\u0638\u0647\u0627,\u0647\u0644 \u0627\u0646\u062a \u0645\u062a\u0627\u0643\u062f \u0645\u0646 \u0645\u063a\u0627\u062f\u0631\u0629 \u0627\u0644\u0635\u0641\u062d\u0629"}}).afterClosed().subscribe({next:c=>o(c),error:c=>u()})}))})()}}m.\u0275fac=function(e){return new(e||m)(t.LFG(d.uw))},m.\u0275prov=t.Yz7({token:m,factory:m.\u0275fac});var Q=a(9183),p=a(1390);class A{constructor(){}ngOnInit(){}}A.\u0275fac=function(e){return new(e||A)},A.\u0275cmp=t.Xpm({type:A,selectors:[["app-order"]],decls:1,vars:0,template:function(e,i){1&e&&t._UZ(0,"router-outlet")},dependencies:[p.lC]});var l=a(5316),Z=a(9198),Y=a(314),k=a(3162);function L(n,e){if(1&n&&(t.TgZ(0,"div",7)(1,"div",8)(2,"h5"),t._uU(3),t.qZA()(),t.TgZ(4,"div",9)(5,"h5"),t._uU(6),t.qZA()(),t.TgZ(7,"div",9)(8,"h5"),t._uU(9),t.qZA()()()),2&n){const i=e.$implicit;let r;t.xp6(3),t.Oqu(null!==(r=i.note)&&void 0!==r?r:i.service),t.xp6(3),t.Oqu(i.quantity),t.xp6(3),t.hij("\xa3",i.price,"")}}class b{constructor(e,i,r,o){this.data=e,this._order=i,this.dialog=r,this.getRowId=o,this.subscriptions=[]}ngOnInit(){this.id=this.getRowId.getOrderId(),this._order.getOne(this.id).subscribe(e=>{this.order=e,console.log(this.order)})}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}orderTrackingProgress(e){switch(e){case l.q.\u063a\u064a\u0631_\u0645\u0643\u062a\u0645\u0644:return 0;case l.q.\u0627\u0639\u062f\u0627\u062f:return 25;case l.q.\u062c\u0627\u0647\u0632:return 50;case l.q.\u0627\u0633\u062a\u0644\u0645:return 75;case l.q.\u0627\u0643\u062a\u0645\u0644:return 100;default:return 0}}}b.\u0275fac=function(e){return new(e||b)(t.Y36(d.WI),t.Y36(Z.p),t.Y36(d.uw),t.Y36(Y.B))},b.\u0275cmp=t.Xpm({type:b,selectors:[["app-details"]],decls:96,vars:14,consts:[["mat-dialog-title",""],["id","print-section",1,"mat-typography"],[1,"info"],[1,"row","direction"],[1,"col-4","w"],["id","heading"],[1,"pricing"],[1,"row"],[1,"col-6"],[1,"col-3"],["class","row",4,"ngFor","ngForOf"],[1,"total"],[1,"col-9"],[1,"hide"],[1,"w-100","d-flex","flex-column","justify-content-center","align-items-center","flex-nowrap","align-content-center"],["mode","determinate","color","warn",1,"row",3,"value"],[1,"tracklist","row","w-100","justify-content-between"],[1,"col-nader","text-nowrap","me-0"]],template:function(e,i){1&e&&(t.TgZ(0,"h2",0),t._uU(1,"\u062a\u0641\u0627\u0635\u064a\u0644 \u0627\u0644\u0637\u0644\u0628"),t.qZA(),t.TgZ(2,"mat-dialog-content",1)(3,"div",2)(4,"div",3)(5,"div",4)(6,"span",5)(7,"strong"),t._uU(8,"\u0627\u0644\u062a\u0627\u0631\u064a\u062e"),t.qZA()(),t._UZ(9,"br"),t.TgZ(10,"span"),t._uU(11),t.ALo(12,"date"),t.qZA()(),t.TgZ(13,"div",4)(14,"span",5)(15,"strong"),t._uU(16,"\u062a\u0645 \u0628\u0648\u0627\u0633\u0637\u0629"),t.qZA()(),t._UZ(17,"br"),t.TgZ(18,"span"),t._uU(19),t.qZA()(),t.TgZ(20,"div",4)(21,"span",5)(22,"strong"),t._uU(23,"\u0643\u0648\u062f \u0627\u0644\u0637\u0644\u0628"),t.qZA()(),t._UZ(24,"br"),t.TgZ(25,"span"),t._uU(26),t.qZA()()()(),t.TgZ(27,"div",6)(28,"div",7)(29,"div",8)(30,"h4")(31,"strong"),t._uU(32,"\u0627\u0644\u0635\u0646\u0641"),t.qZA()()(),t.TgZ(33,"div",9)(34,"h4")(35,"strong"),t._uU(36,"\u0627\u0644\u0643\u0645\u064a\u0629"),t.qZA()()(),t.TgZ(37,"div",9)(38,"h4")(39,"strong"),t._uU(40,"\u0627\u0644\u0633\u0639\u0631"),t.qZA()()()(),t.YNc(41,L,10,3,"div",10),t.qZA(),t.TgZ(42,"div",11)(43,"div",7)(44,"div",12),t._uU(45,"\u0627\u0644\u0623\u062c\u0645\u0627\u0644\u064a"),t.qZA(),t.TgZ(46,"div",9)(47,"strong"),t._uU(48),t.qZA()()(),t.TgZ(49,"div",7)(50,"div",12),t._uU(51,"\u0627\u0644\u062e\u0635\u0645 \u0628\u0627\u0644\u0645\u0628\u0644\u063a"),t.qZA(),t.TgZ(52,"div",9)(53,"strong"),t._uU(54),t.qZA()()(),t.TgZ(55,"div",7)(56,"div",12),t._uU(57,"\u0646\u0633\u0628\u0629 \u0627\u0644\u062e\u0635\u0645"),t.qZA(),t.TgZ(58,"div",9)(59,"strong"),t._uU(60),t.qZA()()(),t.TgZ(61,"div",7)(62,"div",12),t._uU(63,"\u0627\u0644\u0633\u0639\u0631 \u0627\u0644\u0646\u0647\u0627\u0626\u064a"),t.qZA(),t.TgZ(64,"div",9)(65,"strong"),t._uU(66),t.qZA()()(),t.TgZ(67,"div",7)(68,"div",12),t._uU(69,"\u0627\u0644\u0645\u062f\u0641\u0648\u0639"),t.qZA(),t.TgZ(70,"div",9)(71,"strong"),t._uU(72),t.qZA()()(),t.TgZ(73,"div",7)(74,"div",12),t._uU(75,"\u0627\u0644\u0645\u062a\u0628\u0642\u064a"),t.qZA(),t.TgZ(76,"div",9)(77,"strong"),t._uU(78),t.qZA()()()(),t.TgZ(79,"div",13)(80,"h3")(81,"strong"),t._uU(82,"\u062a\u062a\u0628\u0639 \u0627\u0644\u0637\u0644\u0628"),t.qZA()(),t.TgZ(83,"div",14),t._UZ(84,"mat-progress-bar",15),t.TgZ(85,"ul",16)(86,"li",17),t._uU(87,"\u063a\u064a\u0631 \u0645\u0643\u062a\u0645\u0644"),t.qZA(),t.TgZ(88,"li",17),t._uU(89,"\u0627\u0639\u062f\u0627\u062f"),t.qZA(),t.TgZ(90,"li",17),t._uU(91,"\u062c\u0627\u0647\u0632"),t.qZA(),t.TgZ(92,"li",17),t._uU(93,"\u062a\u0645 \u0627\u0644\u062a\u0633\u0644\u064a\u0645"),t.qZA(),t.TgZ(94,"li",17),t._uU(95,"\u0627\u0643\u062a\u0645\u0644"),t.qZA()()()()()),2&e&&(t.xp6(11),t.Oqu(t.xi3(12,11,i.order.createdOn,"dd/MM/yyyy")),t.xp6(8),t.Oqu(i.order.createdBy),t.xp6(7),t.Oqu(i.order.id),t.xp6(15),t.Q6J("ngForOf",i.order.orderDetails),t.xp6(7),t.hij("\xa3",i.order.totalPrice,""),t.xp6(6),t.hij("\xa3",i.order.discount,""),t.xp6(6),t.hij("% ",i.order.discountPercent,""),t.xp6(6),t.hij("\xa3",i.order.finalPrice,""),t.xp6(6),t.hij("\xa3",i.order.paid,""),t.xp6(6),t.hij("\xa3",i.order.rest,""),t.xp6(6),t.Q6J("value",i.orderTrackingProgress(i.order.orderStatus)))},dependencies:[g.sg,d.uh,d.xY,k.pW,g.uU],styles:[".info[_ngcontent-%COMP%]{padding:0 8% 2%}.info[_ngcontent-%COMP%]   .col-5[_ngcontent-%COMP%]{padding:0}#heading[_ngcontent-%COMP%]{color:gray}.pricing[_ngcontent-%COMP%]{background-color:#ddd3;padding:0 8%;font-weight:400}.pricing[_ngcontent-%COMP%]   .col-3[_ngcontent-%COMP%]{padding:0}.total[_ngcontent-%COMP%]{padding:2vh 8%;font-weight:700}.total[_ngcontent-%COMP%]   .col-3[_ngcontent-%COMP%]{padding:0}.tracklist[_ngcontent-%COMP%]{list-style:none;padding:0}.col-nader[_ngcontent-%COMP%]{width:12.5%;margin:0}.mat-typography[_ngcontent-%COMP%]{width:750px}@media print{.hide[_ngcontent-%COMP%]{display:none}.mat-typography[_ngcontent-%COMP%]{width:8cm}.direction[_ngcontent-%COMP%]{flex-direction:column}.w[_ngcontent-%COMP%]{width:100%!important}}"]});var x=a(3715),V=a(2893);class T{constructor(e,i,r,o){this.translate=e,this._order=i,this.dialog=r,this.alertService=o,this.subscriptions=[],this.handleDelete=u=>this.subscriptions.push(this._order.delete(u).subscribe(()=>this.getAll()))}ngOnInit(){this.tableColumns=[{columnDef:"id",header:this.translate.instant("order.number"),cell:e=>`${e.id}`},{columnDef:"TotalPrice",header:this.translate.instant("shared.totalPrice"),cell:e=>`${e.totalPrice}`},{columnDef:"rest",header:this.translate.instant("order.rest"),cell:e=>`${e.rest}`},{columnDef:"Paid",header:this.translate.instant("order.paid"),cell:e=>`${e.paid}`},{columnDef:"Status",header:this.translate.instant("order.status"),cell:e=>`${this.getStatusText(e.orderStatus)}`},{columnDef:"Client",header:this.translate.instant("shared.clientName"),cell:e=>`${e.clientName}`},{columnDef:"Remarks",header:this.translate.instant("shared.notice"),cell:e=>e.remarks}],this.getAll()}getAll(){this.loading=!0,this.subscriptions.push(this._order.getAll().subscribe({next:e=>{this.tableData=e},error:e=>{this.alertService.onError(e.message,this.translate.instant("cantLoadData")),this.loading=!1},complete:()=>{this.loading=!1}}))}handleOrderDetails(e){this.subscriptions.push(this.dialog.open(b).afterClosed().subscribe(()=>{}))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}getStatusText(e){switch(e){case l.q.\u0627\u0633\u062a\u0644\u0645:return"\u0627\u0633\u062a\u0644\u0645";case l.q.\u0627\u0639\u062f\u0627\u062f:return"\u0627\u0639\u062f\u0627\u062f";case l.q.\u0627\u0643\u062a\u0645\u0644:return"\u0627\u0643\u062a\u0645\u0644";case l.q.\u062c\u0627\u0647\u0632:return"\u062c\u0627\u0647\u0632";case l.q.\u062d\u062c\u0632:return"\u062d\u062c\u0632";case l.q.\u063a\u064a\u0631_\u0645\u0643\u062a\u0645\u0644:return"\u063a\u064a\u0631 \u0645\u0643\u062a\u0645\u0644";case l.q.\u0645\u0631\u062a\u062c\u0639:return"\u0645\u0631\u062a\u062c\u0639";default:return""}}}T.\u0275fac=function(e){return new(e||T)(t.Y36(q.sK),t.Y36(Z.p),t.Y36(d.uw),t.Y36(x.Q))},T.\u0275cmp=t.Xpm({type:T,selectors:[["app-all"]],decls:1,vars:6,consts:[["dialogHeader","\u062d\u0630\u0641 \u0627\u0644\u0637\u0644\u0628","dialogLocationAR","\u0627\u0644\u0637\u0644\u0628","dialogDisplayName","id",3,"loading","canView","hasTransaction","isDisplayDeleteButton","tableColumns","tableData","OnDelete","OnView"]],template:function(e,i){1&e&&(t.TgZ(0,"app-table",0),t.NdJ("OnDelete",function(o){return i.handleDelete(o)})("OnView",function(o){return i.handleOrderDetails(o)}),t.qZA()),2&e&&t.Q6J("loading",i.loading)("canView",!0)("hasTransaction",!0)("isDisplayDeleteButton",!1)("tableColumns",i.tableColumns)("tableData",i.tableData)},dependencies:[V.a]});var G=a(4128),j=a(262),B=a(9646),I=a(4004),R=a(7843),$=a(4467),H=a(9648),K=a(8653),X=a(8967),C=a(9549),z=a(7392),S=a(4144),W=a(4385),tt=a(3238),P=a(4859);const et=["matNoteId"],it=["matServiceId"],rt=["clientType"];function nt(n,e){1&n&&(t.TgZ(0,"h2",29),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"order.edit")))}function ot(n,e){1&n&&(t.TgZ(0,"h2",29),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"order.new")))}function at(n,e){if(1&n){const i=t.EpF();t.TgZ(0,"mat-option",30),t.NdJ("onSelectionChange",function(){const u=t.CHM(i).$implicit,c=t.oxw();return t.KtG(c.getAllClientsByType(u))}),t._uU(1),t.qZA()}if(2&n){const i=e.$implicit;t.Q6J("value",i.id),t.xp6(1),t.Oqu(i.name)}}function st(n,e){if(1&n&&(t.TgZ(0,"mat-option",31),t._uU(1),t.qZA()),2&n){const i=e.$implicit;t.Q6J("value",i.id),t.xp6(1),t.Oqu(i.name)}}function lt(n,e){1&n&&(t.TgZ(0,"div",50),t._UZ(1,"input",52),t.qZA())}function ut(n,e){if(1&n&&(t.TgZ(0,"div",50),t.YNc(1,lt,2,0,"div",51),t.qZA()),2&n){const i=t.oxw(3);t.xp6(1),t.Q6J("ngForOf",i.orderToBeUpdated.orderDetails)}}function ct(n,e){if(1&n&&(t.TgZ(0,"mat-option",31),t._uU(1),t.qZA()),2&n){const i=e.$implicit;t.Q6J("value",i.id),t.xp6(1),t.Oqu(i.name)}}function dt(n,e){if(1&n&&(t.TgZ(0,"mat-option",31),t._uU(1),t.qZA()),2&n){const i=e.$implicit;t.Q6J("value",i.id),t.xp6(1),t.Oqu(i.name)}}function mt(n,e){if(1&n&&(t.TgZ(0,"mat-option",31),t._uU(1),t.qZA()),2&n){const i=e.$implicit,r=t.oxw(3);t.Q6J("value",i),t.xp6(1),t.hij(" ",r.getStatusLabel(i)," ")}}function pt(n,e){if(1&n){const i=t.EpF();t.TgZ(0,"div",4),t.ynx(1,34),t.TgZ(2,"div",19),t.YNc(3,ut,2,1,"div",35),t.TgZ(4,"mat-form-field",36)(5,"mat-label"),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.TgZ(8,"mat-select",37,38),t.NdJ("selectionChange",function(o){const c=t.CHM(i).index,h=t.oxw(2);return t.KtG(h.getPrice(o.value,c))}),t.YNc(10,ct,2,2,"mat-option",11),t._UZ(11,"hr"),t.TgZ(12,"div",39)(13,"div",40)(14,"button",41),t.NdJ("click",function(){const u=t.CHM(i).index,c=t.MAs(9),h=t.oxw(2);return t.KtG(h.enableAndDisableDDL(u,c))}),t._uU(15,"disable"),t.qZA()()()()()(),t.TgZ(16,"div",42)(17,"mat-form-field",36)(18,"mat-label"),t._uU(19),t.ALo(20,"translate"),t.qZA(),t.TgZ(21,"mat-select",43,44),t.NdJ("selectionChange",function(){const u=t.CHM(i).index,c=t.oxw(2);return t.KtG(c.onNoteValueChanged(u))}),t.YNc(23,dt,2,2,"mat-option",11),t._UZ(24,"hr"),t.TgZ(25,"div",39)(26,"div",40)(27,"button",41),t.NdJ("click",function(){const u=t.CHM(i).index,c=t.MAs(22),h=t.oxw(2);return t.KtG(h.enableAndDisableDDL(u,c))}),t._uU(28,"disable"),t.qZA()()()()()(),t.TgZ(29,"div",42)(30,"mat-form-field",36)(31,"mat-label"),t._uU(32),t.ALo(33,"translate"),t.qZA(),t.TgZ(34,"input",45),t.NdJ("change",function(){const u=t.CHM(i).index,c=t.oxw(2);return t.KtG(c.getQuantityAndUpdatePriceInputForService(u))}),t.qZA()()(),t.TgZ(35,"div",42)(36,"mat-form-field",16)(37,"mat-label"),t._uU(38),t.ALo(39,"translate"),t.qZA(),t._UZ(40,"input",46,47),t.qZA()(),t.TgZ(42,"div",42)(43,"mat-form-field",36)(44,"mat-label"),t._uU(45),t.ALo(46,"translate"),t.qZA(),t.TgZ(47,"mat-select",48),t.YNc(48,mt,2,2,"mat-option",11),t.qZA()()(),t.TgZ(49,"div",12)(50,"button",49),t.NdJ("click",function(){const u=t.CHM(i).index,c=t.oxw(2);return t.KtG(c.handleDeleteDetail(u))}),t.TgZ(51,"mat-icon"),t._uU(52,"delete"),t.qZA()()(),t.BQk(),t.qZA()}if(2&n){const i=e.index,r=t.oxw(2);t.xp6(1),t.Q6J("formGroupName",i),t.xp6(2),t.Q6J("ngIf",r.orderToBeUpdated),t.xp6(3),t.Oqu(t.lcZ(7,13,"service.name")),t.xp6(2),t.Q6J("id","mat-service-"+i.toString()),t.xp6(2),t.Q6J("ngForOf",r.ServicesDataSource),t.xp6(9),t.Oqu(t.lcZ(20,15,"note.name")),t.xp6(4),t.Q6J("ngForOf",r.NotesDataSource),t.xp6(9),t.Oqu(t.lcZ(33,17,"quantity")),t.xp6(6),t.Oqu(t.lcZ(39,19,"shared.price")),t.xp6(2),t.Q6J("readonly",!0),t.xp6(5),t.Oqu(t.lcZ(46,21,"order.status")),t.xp6(3),t.Q6J("ngForOf",r.availableStatus),t.xp6(2),t.Q6J("disabled",r.disableMode)}}function ht(n,e){if(1&n&&(t.TgZ(0,"div",32),t.YNc(1,pt,53,23,"div",33),t.qZA()),2&n){const i=t.oxw();t.xp6(1),t.Q6J("ngForOf",i.OrderDetails.controls)}}class f{constructor(e,i,r,o,u,c,h,At,Zt,bt,Tt){this.router=e,this.route=i,this._service=r,this._note=o,this._order=u,this.fb=c,this._client=h,this._clientType=At,this.alertService=Zt,this.servicePriceService=bt,this.translate=Tt,this._clientTypeId=-1,this.availableStatus=[l.q.\u0627\u0633\u062a\u0644\u0645,l.q.\u062d\u062c\u0632,l.q.\u0645\u0631\u062a\u062c\u0639],this.subscriptions=[],this.isSubmitted=!1,this.ServicesDataSource=[],this.NotesDataSource=[],this.ClientsDataSource=[],this.ClientTypesDataSource=[],this.disableMode=!1,this.key=0,this.prices=[],this.getSingle=D=>this.subscriptions.push(this._order.getOne(D).subscribe(N=>{this.orderToBeUpdated=N,this.fillFormWithData(N)})),this.back=()=>this.router.navigate([this.translate.instant("order.router.name")]),this.handleNewDetail=()=>{this.OrderDetails.push(this.createFormItem("detail")),this.id&&this.disableAllControls(),this.key=this.OrderDetails.controls.length-1,this.prices.push({key:this.key,value:-1}),this.key++},this.handleDeleteDetail=D=>{this.OrderDetails.removeAt(D),this.deleteSelectedElementFromMappedObject(D)},this.Form=this.createFormItem("init")}ngAfterViewInit(){}ngOnInit(){this.forkJoins(),this.subscriptions.push(this.route.queryParams.subscribe(e=>{this.id=e.id,this.id&&this.getSingle(this.id)}))}forkJoins(){let e=[this._note.getAll(),this._clientType.getAll(),this._service.getAll()];return(0,G.D)(e).pipe((0,j.K)(i=>(0,B.of)(i)),(0,I.U)(([i,r,o])=>({notes:i,clientsType:r,services:o}))).subscribe(i=>{this.NotesDataSource=i.notes.body,this.ServicesDataSource=i.services,this.ClientTypesDataSource=i.clientsType})}getStatusLabel(e){switch(e){case l.q.\u062d\u062c\u0632:return"\u062d\u062c\u0632";case l.q.\u0627\u0639\u062f\u0627\u062f:return"\u0627\u0639\u062f\u0627\u062f";case l.q.\u062c\u0627\u0647\u0632:return"\u062c\u0627\u0647\u0632";case l.q.\u0627\u0633\u062a\u0644\u0645:return"\u0627\u0633\u062a\u0644\u0645";case l.q.\u0645\u0631\u062a\u062c\u0639:return"\u0645\u0631\u062a\u062c\u0639";case l.q.\u0647\u0627\u0644\u0643:return"\u0647\u0627\u0644\u0643";case l.q.\u0627\u0643\u062a\u0645\u0644:return"\u0627\u0643\u062a\u0645\u0644";case l.q.\u063a\u064a\u0631_\u0645\u0643\u062a\u0645\u0644:return"\u063a\u064a\u0631 \u0645\u0631\u062a\u062c\u0639"}}getPrice(e,i){return-1==this._clientTypeId?(this.OrderDetails.controls[i].get("serviceId")?.reset(),this.onServiceValueChanged(i),this.alertService.onError("Please choose a client type first.","Error")):(this.onServiceValueChanged(i),this.subscriptions.push(this.servicePriceService.getPrice(this._clientTypeId,e).subscribe({next:r=>{this.prices?.forEach(o=>{o.key===i&&(o.value=+r.price),this.getQuantityAndUpdatePriceInputForService(i),this.computeTotalPrice(),this.computeFinalPrice(0)})},error:r=>this.alertService.onError(r.message,this.translate.instant("error.cantLoadPrices"))})))}getQuantityAndUpdatePriceInputForService(e){this.OrderDetails.controls[e].get("serviceId")?.disabled&&this.getNotePrice(e),this.OrderDetails.controls[e].get("noteId")?.disabled&&this.prices.forEach(i=>{if(i.key==e){let r=this.OrderDetails.controls[e].get("quantity")?.value;this.OrderDetails.controls[e].get("price")?.setValue(i.value*+r)}}),this.computeTotalPrice(),this.computeFinalPrice(0)}getAllClientsByType(e){this._clientTypeId=e.value,this._clientTypeId&&this.subscriptions.push(this._client.getAllByType(e.value).subscribe({next:i=>{this.ClientsDataSource=i},error:i=>{this.alertService.onError(i.message,this.translate.instant("error.cantLoadData"))}}))}createFormItem(e){let i=this.fb.group({});switch(e){case"init":i=this.fb.group({totalPrice:[null,[s.kI.required]],finalPrice:[null],discount:[null],discountPercent:[null],rest:[{value:null},[s.kI.required]],paid:[null,[s.kI.required]],clientId:[null,[s.kI.required]],orderDetails:this.fb.array([]),remarks:[null]});break;case"detail":i=this.fb.group({id:[0],price:[null],quantity:[1,[s.kI.required]],serviceId:[null],noteId:[null],orderStatus:[l.q.\u0627\u0633\u062a\u0644\u0645,[s.kI.required]]})}return i}get clientId(){return this.Form.get("clientId")}computeDiscountPercent(){const e=this.Form.get("discount"),i=this.Form.get("discountPercent"),r=+this.Form.get("totalPrice")?.value;let o=(e?.value/r*100).toFixed(2).toString();return i?.setValue(o),this.computeFinalPrice(+e?.value),+o}computeDiscountValue(){let e=this.Form.get("discount"),i=this.Form.get("discountPercent");const r=+this.Form.get("totalPrice")?.value;let o=(i?.value/100*r).toFixed(2).toString();return e?.setValue(o),this.computeFinalPrice(+o),+o}clearPriceAndQuantityInput(e){this.OrderDetails.controls[e].get("price")?.setValue(null),this.OrderDetails.controls[e].get("quantity")?.setValue("1")}computeFinalPrice(e){const i=this.Form.get("finalPrice"),r=+this.Form.get("totalPrice")?.value;i?.setValue(r-e),this.computeRest()}computeRest(){const e=this.Form.get("rest"),i=+this.Form.get("paid")?.value,r=+this.Form.get("finalPrice")?.value;e?.setValue(r-i)}computeTotalPrice(){let e=0;const i=this.Form.get("totalPrice");this.OrderDetails.controls.forEach(r=>{+r.get("price")?.value&&(e+=+r.get("price")?.value)}),i?.setValue(e)}fillFormWithData(e){e.orderDetails.forEach(()=>this.handleNewDetail()),this.Form.patchValue(e)}get OrderDetails(){return this.Form.get("orderDetails")}deleteSelectedElementFromMappedObject(e){for(let i=e+1;i<this.prices.length;i++)this.prices[i].key--,this.key--;this.prices.splice(e,1)}getNotePrice(e){let i=this.OrderDetails.controls[e].get("noteId")?.value;this.NotesDataSource.forEach(r=>{if(r.id===i){let o=+(null==r.finalPrice?10:r.finalPrice),u=this.OrderDetails.controls[e].get("quantity")?.value;this.OrderDetails.controls[e].get("price")?.setValue(o*+u)}this.computeTotalPrice(),this.computeFinalPrice(0)})}onServiceValueChanged(e){this.OrderDetails.controls[e].get("noteId")?.disable()}onNoteValueChanged(e){this.OrderDetails.controls[e].get("serviceId")?.disable(),this.getNotePrice(e)}enableAndDisableDDL(e,i){let r=this.OrderDetails.controls[e].get("serviceId"),o=this.OrderDetails.controls[e].get("noteId");r?.disabled?(r?.enable(),o?.disable(),o?.reset(),i.close(),this.clearPriceAndQuantityInput(e)):(o?.enable(),r?.disable(),r?.reset(),i.close(),this.clearPriceAndQuantityInput(e))}disableAllControls(){this.disableMode=!0,this.Form.disable(),this.OrderDetails.value&&(this.OrderDetails.controls.forEach(e=>{e.disable()}),this.OrderDetails.controls.find(e=>{e.get("orderStatus")?.enable()}))}validateDiscountAmountAndPercent(){const e=this.computeDiscountValue(),i=this.computeDiscountPercent(),r=+this.Form.get("finalPrice")?.value;e+r===i/100*+this.Form.get("totalPrice")?.value+r||(this.alertService.onError("discount amount not equals to discount percent",this.translate.instant("error.name")),this.Form.setErrors({invalid:!0}))}setUpdatedOrder(){this.orderToBeUpdated.orderDetails.forEach(e=>{this.OrderDetails.controls.forEach(i=>{let r=i.get("id")?.value;e.id===r&&(e.orderStatus=i.get("orderStatus")?.value)})})}handleSubmit(){this.Form.valid&&(this.id?(this.setUpdatedOrder(),this.subscriptions.push(this._order.updateStatus(this.orderToBeUpdated).subscribe(()=>{this.isSubmitted=!0,this.back()},e=>{console.log(e),this.alertService.onError(e.error.Message,this.translate.instant("error.name"))}))):(this.validateDiscountAmountAndPercent(),this.subscriptions.push(this._order.add(this.Form.value).subscribe(()=>{this.isSubmitted=!0,this.back()},e=>{this.alertService.onError(e.error.Message,this.translate.instant("error.name"))}))))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}}f.\u0275fac=function(e){return new(e||f)(t.Y36(p.F0),t.Y36(p.gz),t.Y36(R.r),t.Y36($.Y),t.Y36(Z.p),t.Y36(s.qu),t.Y36(H.y),t.Y36(K.q),t.Y36(x.Q),t.Y36(X.c),t.Y36(q.sK))},f.\u0275cmp=t.Xpm({type:f,selectors:[["app-add-edit"]],viewQuery:function(e,i){if(1&e&&(t.Gf(et,5),t.Gf(it,5),t.Gf(rt,5)),2&e){let r;t.iGM(r=t.CRH())&&(i.matNoteId=r.first),t.iGM(r=t.CRH())&&(i.matServiceId=r.first),t.iGM(r=t.CRH())&&(i.clientTypeElement=r.first)}},decls:74,vars:39,consts:[["class","w-100 text-center mt-3",4,"ngIf","ngIfElse"],["update",""],[1,"container"],[1,"d-flex","flex-column",3,"formGroup","ngSubmit"],[1,"row"],["appearance","fill",1,"col-4"],[3,"disabled","selectionChange"],["clientType",""],[3,"value","onSelectionChange",4,"ngFor","ngForOf"],["appearance","fill",1,"col-7"],["formControlName","clientId"],[3,"value",4,"ngFor","ngForOf"],[1,"col-1"],["type","button","mat-icon-button","","matTooltip","add","color","basic","aria-label","add order detail row",3,"disabled","click"],["formArrayName","orderDetails",4,"ngIf"],[1,"col-4"],[1,"w-100"],["type","number","matInput","","formControlName","totalPrice",3,"readonly"],["type","number","matInput","","formControlName","discount",3,"change"],[1,"col-3"],["type","number","matInput","","formControlName","discountPercent",3,"change"],["type","number","matInput","","formControlName","finalPrice",3,"readonly"],["type","number","matInput","","formControlName","paid",3,"change"],["type","number","matInput","","formControlName","rest",3,"readonly"],[1,"col-11"],["matInput","","formControlName","remarks"],[1,"my-2","d-flex","flex-row-reverse"],["mat-flat-button","","color","warn",1,"mx-2","px-4",3,"disabled"],["type","button","mat-stroked-button","","color","basic",3,"click"],[1,"w-100","text-center","mt-3"],[3,"value","onSelectionChange"],[3,"value"],["formArrayName","orderDetails"],["class","row",4,"ngFor","ngForOf"],[3,"formGroupName"],["hidden","",4,"ngIf"],["appearance","fill",1,"w-100"],["formControlName","serviceId",3,"id","selectionChange"],["matservice",""],[1,"row","no-gutters","p-1"],[1,"col-sm-12","text-right","m-1"],["type","button",1,"btn","btn-danger",3,"click"],[1,"col-2"],["formControlName","noteId",3,"selectionChange"],["matNote",""],["type","number","matInput","","formControlName","quantity",3,"change"],["type","number","matInput","","formControlName","price",3,"readonly"],["priceRef",""],["formControlName","orderStatus"],["type","button","mat-icon-button","","matTooltip","delete","color","warn","aria-label","delete selected row",3,"disabled","click"],["hidden",""],["hidden","",4,"ngFor","ngForOf"],["hidden","","formControlName","id"]],template:function(e,i){if(1&e&&(t.YNc(0,nt,3,3,"h2",0),t.YNc(1,ot,3,3,"ng-template",null,1,t.W1O),t.TgZ(3,"section",2)(4,"form",3),t.NdJ("ngSubmit",function(){return i.handleSubmit()}),t.TgZ(5,"div",4)(6,"mat-form-field",5)(7,"mat-label"),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.TgZ(10,"mat-select",6,7),t.NdJ("selectionChange",function(o){return i.getAllClientsByType(o)}),t.YNc(12,at,2,2,"mat-option",8),t.qZA()(),t.TgZ(13,"mat-form-field",9)(14,"mat-label"),t._uU(15),t.ALo(16,"translate"),t.qZA(),t.TgZ(17,"mat-select",10),t.YNc(18,st,2,2,"mat-option",11),t.qZA()(),t.TgZ(19,"div",12)(20,"button",13),t.NdJ("click",function(){return i.handleNewDetail()}),t.TgZ(21,"mat-icon"),t._uU(22,"add"),t.qZA()()()(),t.YNc(23,ht,2,1,"div",14),t.TgZ(24,"div",4)(25,"div",15)(26,"mat-form-field",16)(27,"mat-label"),t._uU(28),t.ALo(29,"translate"),t.qZA(),t._UZ(30,"input",17),t.qZA()(),t.TgZ(31,"div",15)(32,"mat-form-field",16)(33,"mat-label"),t._uU(34),t.ALo(35,"translate"),t.qZA(),t.TgZ(36,"input",18),t.NdJ("change",function(){return i.computeDiscountPercent()}),t.qZA()()(),t.TgZ(37,"div",19)(38,"mat-form-field",16)(39,"mat-label"),t._uU(40),t.ALo(41,"translate"),t.qZA(),t.TgZ(42,"input",20),t.NdJ("change",function(){return i.computeDiscountValue()}),t.qZA()()()(),t.TgZ(43,"div",4)(44,"div",15)(45,"mat-form-field",16)(46,"mat-label"),t._uU(47),t.ALo(48,"translate"),t.qZA(),t._UZ(49,"input",21),t.qZA()(),t.TgZ(50,"div",15)(51,"mat-form-field",16)(52,"mat-label"),t._uU(53),t.ALo(54,"translate"),t.qZA(),t.TgZ(55,"input",22),t.NdJ("change",function(){return i.computeRest()}),t.qZA()()(),t.TgZ(56,"div",19)(57,"mat-form-field",16)(58,"mat-label"),t._uU(59),t.ALo(60,"translate"),t.qZA(),t._UZ(61,"input",23),t.qZA()()(),t.TgZ(62,"div",4)(63,"div",24)(64,"mat-form-field",16)(65,"mat-label"),t._uU(66),t.ALo(67,"translate"),t.qZA(),t._UZ(68,"textarea",25),t.qZA()()(),t.TgZ(69,"div",26)(70,"button",27),t._uU(71,"\u062d\u0641\u0638"),t.qZA(),t.TgZ(72,"button",28),t.NdJ("click",function(){return i.back()}),t._uU(73,"\u0631\u062c\u0648\u0639"),t.qZA()()()()),2&e){const r=t.MAs(2);t.Q6J("ngIf",i.id)("ngIfElse",r),t.xp6(4),t.Q6J("formGroup",i.Form),t.xp6(4),t.Oqu(t.lcZ(9,21,"shared.clientType")),t.xp6(2),t.Q6J("disabled",i.disableMode),t.xp6(2),t.Q6J("ngForOf",i.ClientTypesDataSource),t.xp6(3),t.Oqu(t.lcZ(16,23,"shared.client")),t.xp6(3),t.Q6J("ngForOf",i.ClientsDataSource),t.xp6(2),t.Q6J("disabled",i.disableMode||!i.clientId.value||i.clientId.invalid),t.xp6(3),t.Q6J("ngIf",i.OrderDetails.controls.length),t.xp6(5),t.Oqu(t.lcZ(29,25,"shared.totalPrice")),t.xp6(2),t.Q6J("readonly",!0),t.xp6(4),t.Oqu(t.lcZ(35,27,"shared.discountValue")),t.xp6(6),t.Oqu(t.lcZ(41,29,"shared.discountPercent")),t.xp6(7),t.Oqu(t.lcZ(48,31,"shared.finalPrice")),t.xp6(2),t.Q6J("readonly",!0),t.xp6(4),t.Oqu(t.lcZ(54,33,"shared.paid")),t.xp6(6),t.Oqu(t.lcZ(60,35,"shared.rest")),t.xp6(2),t.Q6J("readonly",!0),t.xp6(5),t.Oqu(t.lcZ(67,37,"shared.clientRemarks")),t.xp6(4),t.s9C("disabled",!i.Form.valid)}},dependencies:[s._Y,s.Fj,s.wV,s.JJ,s.JL,s.sg,s.u,s.x0,s.CE,g.sg,g.O5,C.KE,C.hX,z.Hw,S.Nt,W.gD,tt.ey,P.lW,P.RK,q.X$]});var O=a(3546);function ft(n,e){1&n&&(t.TgZ(0,"mat-error"),t._uU(1,"\u0627\u0644\u0645\u0628\u0644\u063a \u0627\u0644\u0645\u062f\u0641\u0648\u0639 \u0645\u0637\u0644\u0648\u0628"),t.qZA())}function vt(n,e){if(1&n&&(t.TgZ(0,"mat-error"),t._uU(1),t.qZA()),2&n){const i=t.oxw();t.xp6(1),t.hij(" \u0627\u0644\u0645\u0628\u0644\u063a \u0627\u0644\u0645\u062f\u0641\u0648\u0639 < \u0627\u0648 = ",null==i.f.paid.errors?null:i.f.paid.errors.value," ")}}class y{get f(){return this.Form.controls}constructor(e,i,r,o,u){this._order=e,this.router=i,this.route=r,this.dialog=o,this.fb=u,this.subscriptions=[],this.controllerName="orders",this.isSubmitting=!1,this.back=()=>this.router.navigate([this.controllerName]),this.subscriptions.push(this.route.queryParams.subscribe(c=>{this.id=c.id})),this.Form=this.createFormItems()}ngOnInit(){}handleSubmit(){this.Form.valid&&this.id&&this.subscriptions.push(this._order.addOrderTransaction(this.Form.value).subscribe({next:()=>{this.isSubmitting=!0},error:()=>{this.isSubmitting=!1},complete:()=>{this.back(),this.isSubmitting=!1}}))}createFormItems(){return this.fb.group({orderId:[this.id,[s.kI.required]],paid:["",[s.kI.required],[(n=this._order,e=this.id,i=>n.getOne(e).pipe((0,I.U)(r=>(console.log(r.rest<i.value),r.rest<i.value?{exceed:!0,value:r.rest}:null))))]]});var n,e}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}}y.\u0275fac=function(e){return new(e||y)(t.Y36(Z.p),t.Y36(p.F0),t.Y36(p.gz),t.Y36(d.uw),t.Y36(s.qu))},y.\u0275cmp=t.Xpm({type:y,selectors:[["app-transaction"]],decls:21,vars:5,consts:[[1,"container","mat-elevation-z15","py-2"],[3,"formGroup","ngSubmit"],["appearance","fill",1,"w-100"],["type","text","matInput","","formControlName","orderId","readonly",""],["id","paid","matInput","","type","number","formControlName","paid"],[4,"ngIf"],["mat-dialog-actions",""],["mat-raised-button","","type","submit","color","primary",1,"mx-2","px-4",3,"disabled"],["type","button","mat-stroked-button","","color","warn","tabindex","-1",3,"click"]],template:function(e,i){1&e&&(t.TgZ(0,"mat-card",0)(1,"form",1),t.NdJ("ngSubmit",function(){return i.handleSubmit()}),t.TgZ(2,"mat-card-header")(3,"mat-card-title"),t._uU(4,"\u0639\u0645\u0644\u064a\u0647"),t.qZA()(),t.TgZ(5,"mat-card-content")(6,"mat-form-field",2)(7,"mat-label"),t._uU(8,"\u0631\u0642\u0645 \u0627\u0644\u0637\u0644\u0628"),t.qZA(),t._UZ(9,"input",3),t.qZA(),t.TgZ(10,"mat-form-field",2)(11,"mat-label"),t._uU(12,"\u0627\u0644\u0645\u062f\u0641\u0648\u0639"),t.qZA(),t._UZ(13,"input",4),t.YNc(14,ft,2,0,"mat-error",5),t.YNc(15,vt,2,1,"mat-error",5),t.qZA()(),t.TgZ(16,"div",6)(17,"button",7),t._uU(18),t.qZA(),t.TgZ(19,"button",8),t.NdJ("click",function(){return i.back()}),t._uU(20,"\u0631\u062c\u0648\u0639"),t.qZA()()()()),2&e&&(t.xp6(1),t.Q6J("formGroup",i.Form),t.xp6(13),t.Q6J("ngIf",null==i.f.paid.errors?null:i.f.paid.errors.required),t.xp6(1),t.Q6J("ngIf",i.f.paid.hasError("exceed")),t.xp6(2),t.Q6J("disabled",!i.Form.valid||i.isSubmitting),t.xp6(1),t.Oqu(i.isSubmitting?"\u0627\u0646\u062a\u0638\u0631 \u0645\u0646 \u0641\u0636\u0644\u0643":"\u062d\u0641\u0638"))},dependencies:[s._Y,s.Fj,s.wV,s.JJ,s.JL,s.sg,s.u,g.O5,d.H8,C.KE,C.hX,C.TO,S.Nt,O.a8,O.dn,O.dk,O.n5,P.lW],styles:["mat-card[_ngcontent-%COMP%]{width:20%}[_nghost-%COMP%]{height:100%;display:flex;justify-content:center;vertical-align:middle;align-items:center}  datepicker-value-example .mat-form-field-label{color:#f84bb3}  .mat-datepicker-toggle{color:#fad}  .mat-form-field-underline{color:#fad}"]});const _t=[{path:"",component:A,title:"\u0627\u0644\u0637\u0644\u0628\u0627\u062a",canActivateChild:[F.i],children:[{path:"all",component:T,title:"\u062c\u0645\u064a\u0639 \u0627\u0644\u0637\u0644\u0628\u0627\u062a"},{path:"new",component:f,title:"\u0637\u0644\u0628 \u062c\u062f\u064a\u062f",canDeactivate:[m]},{path:"edit",component:f,title:"\u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u0637\u0644\u0628",canDeactivate:[m]},{path:"transaction",component:y,title:"\u062a\u0639\u0627\u0645\u0644\u0627\u062a \u0645\u0627\u0644\u064a\u0629 \u0639\u0644\u064a \u0627\u0644\u0637\u0644\u0628"},{path:"returns",component:Q.r,title:"\u0627\u0644\u0645\u0631\u062a\u062c\u0639\u0627\u062a"},{path:"",redirectTo:"all",pathMatch:"full"}]}];class v{}v.\u0275fac=function(e){return new(e||v)},v.\u0275mod=t.oAB({type:v}),v.\u0275inj=t.cJS({imports:[p.Bz.forChild(_t),p.Bz]});class _{}_.\u0275fac=function(e){return new(e||_)},_.\u0275mod=t.oAB({type:_}),_.\u0275inj=t.cJS({providers:[F.i,Z.p,m],imports:[s.u5,s.UX,g.ez,v,J.SharedModule,E.I,q.aw]})}}]);