"use strict";(self.webpackChunkOneLibraryUI=self.webpackChunkOneLibraryUI||[]).push([[179],{6578:(d,f,t)=>{t.d(f,{i:()=>u});var i=t(5861),n=t(3175),m=t(9808),c=t(4650),A=t(1390),h=t(2746);class u{constructor(o,s){this._router=o,this._auth=s,this.jwtHelper=new n.N0}canActivateChild(){var o=this;return(0,i.Z)(function*(){return o.Auth()})()}canActivate(){var o=this;return(0,i.Z)(function*(){return o.Auth()})()}canLoad(){var o=this;return(0,i.Z)(function*(){return o.Auth()})()}Auth(){var o=this;return(0,i.Z)(function*(){const s=localStorage.getItem("token");if(s&&!o.jwtHelper.isTokenExpired(s)||s)return!0;const v=yield o.refreshingTokens(s);return v||o._router.navigate(["/auth/login"]),v})()}refreshingTokens(o){var s=this;return(0,i.Z)(function*(){const v=localStorage.getItem("refreshToken");if(!o||!v)return!1;let E=!1;try{const S=yield(0,m.n)(s._auth.refreshToken());S&&s._auth.setLocalStorage(S.body),E=!0}catch{E=!1,s._auth.clearLocalStorage(),s._auth.username.next(null)}return E})()}}u.\u0275fac=function(o){return new(o||u)(c.LFG(A.F0),c.LFG(h.e))},u.\u0275prov=c.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"})},2746:(d,f,t)=>{t.d(f,{e:()=>h});var i=t(1135),n=t(3151),m=t(2340),c=t(4650),A=t(529);class h{constructor(e){this.http=e,this.isLogged=!!localStorage.getItem("token"),this.username=new i.X(null),this.uri=`${m.N.apiUrl}Authorzation/`,this.isLogged=!!localStorage.getItem("token")}login(e){return this.http.post(`${this.uri}LogIn`,e).pipe((0,n.d)())}forgetPassword(e){return this.http.post(`${this.uri}ForgetPassword?email=${e}`,null)}resetPassword(e){return this.http.post(`${this.uri}ResetPassword`,e)}changePassword(e,o){return this.http.put(`${this.uri}changePassword?id=${e}`,o)}confirmEmail(e,o){return this.http.get(`${this.uri}confirmEmail`,{params:{userid:e,token:o}})}getUserById(e){return this.http.get(`${this.uri}Profile`,{params:{id:e}})}UpdateUser(e,o){return this.http.put(`${this.uri}?id=${e}`,o)}refreshToken(){return this.http.post(`${this.uri}refreshToken`,{token:localStorage.getItem("refreshToken")})}setLocalStorage(e){localStorage.setItem("token",e.token),localStorage.setItem("refreshToken",e.refreshToken),localStorage.setItem("refreshTokenExp",e.refreshTokenExpiration.toString()),localStorage.setItem("uname",e.username),localStorage.setItem("uid",e.id),localStorage.setItem("iSCheckedIn",e.isCheckedIn.toString())}clearLocalStorage(){localStorage.clear()}}h.\u0275fac=function(e){return new(e||h)(c.LFG(A.eN))},h.\u0275prov=c.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"})},2340:(d,f,t)=>{t.d(f,{N:()=>n});let i="http://192.168.1.111:991/";const n={production:!0,apiUrl:`${i}api/`,host:i}},2938:(d,f,t)=>{var i=t(1481),n=t(4650),m=t(6578),c=t(1390);const A=[{path:"auth",loadChildren:()=>Promise.all([t.e(42),t.e(592),t.e(420)]).then(t.bind(t,8420)).then(a=>a.AuthModule)},{path:"",loadChildren:()=>Promise.all([t.e(42),t.e(110)]).then(t.bind(t,7110)).then(a=>a.SharedModule),canLoad:[m.i]}];class h{}h.\u0275fac=function(r){return new(r||h)},h.\u0275mod=n.oAB({type:h}),h.\u0275inj=n.cJS({imports:[c.Bz.forRoot(A),c.Bz]});var u=t(9383);class e{constructor(r){this.translate=r,this.title="OneLibraryUI",r.setDefaultLang("ar"),r.use("ar")}}e.\u0275fac=function(r){return new(r||e)(n.Y36(u.sK))},e.\u0275cmp=n.Xpm({type:e,selectors:[["app-root"]],decls:1,vars:0,template:function(r,g){1&r&&n._UZ(0,"router-outlet")},dependencies:[c.lC]});var o=t(6895),s=t(529),v=t(1135),E=t(262),S=t(2843),I=t(3900),O=t(9300),y=t(5698),D=t(2746),P=t(7185);class T{constructor(r,g,l){this._auth=r,this.router=g,this.toastr=l,this.isRefreshing=!1,this.refreshTokenSubject=new v.X(null)}intercept(r,g){r=r.clone({headers:r.headers.set("Content-Type","application/json")});let l=localStorage.getItem("token");return l&&(r=r.clone({headers:r.headers.set("Authorization",`Bearer ${l}`)})),g.handle(r).pipe((0,E.K)(p=>p instanceof s.UA&&401===p.status?this.handle401Error(r,g):(0,S._)(()=>p)))}handle401Error(r,g){return this.isRefreshing?this.refreshTokenSubject.pipe((0,O.h)(l=>null!=l),(0,y.q)(1),(0,I.w)(l=>g.handle(r.clone({setHeaders:{Authorization:l}})))):(this.isRefreshing=!0,this.refreshTokenSubject.next(null),this._auth.refreshToken().pipe((0,E.K)(l=>(this.toastr.error(l.message),this._auth.clearLocalStorage(),this._auth.username.next(null),this.refreshTokenSubject.next(null),this.router.navigate(["/auth/login"]),(0,S._)(()=>l))),(0,I.w)(l=>{if(this.isRefreshing=!1,l){let p=l.body;this._auth.setLocalStorage(p),this._auth.username.next(p.username),this.refreshTokenSubject.next(p.token)}else this._auth.clearLocalStorage(),this._auth.username.next(null),this.refreshTokenSubject.next(null),this.router.navigate(["/auth/login"]);return g.handle(r.clone({setHeaders:{Authorization:`Bearer ${l.body.token}`}}))})))}}T.\u0275fac=function(r){return new(r||T)(n.LFG(D.e),n.LFG(c.F0),n.LFG(P._W))},T.\u0275prov=n.Yz7({token:T,factory:T.\u0275fac});var R=t(1516),C=t(3175),M=t(2340),U=t(9832);class L{}L.\u0275fac=function(r){return new(r||L)},L.\u0275mod=n.oAB({type:L,bootstrap:[e]}),L.\u0275inj=n.cJS({providers:[m.i,{provide:s.TP,useClass:T,multi:!0}],imports:[i.b2,s.JF,h,o.ez,C.Ar.forRoot({config:{tokenGetter:function x(){return localStorage.getItem("token")},allowedDomains:[M.N.host],disallowedRoutes:[]}}),P.Rh.forRoot({preventDuplicates:!0,positionClass:"toast-bottom-left",progressBar:!0,newestOnTop:!0,progressAnimation:"decreasing"}),R.PW,u.aw.forRoot({loader:{provide:u.Zw,useFactory:function B(a){return new U.w(a)},deps:[s.eN]}})]}),M.N.production&&(0,n.G48)(),i.q6().bootstrapModule(L).catch(a=>console.error(a))}},d=>{d.O(0,[736],()=>d(d.s=2938)),d.O()}]);