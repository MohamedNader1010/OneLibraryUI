"use strict";(self.webpackChunkOneLibraryUI=self.webpackChunkOneLibraryUI||[]).push([[166],{4166:(he,N,a)=>{a.r(N),a.d(N,{NoteModule:()=>b});var A=a(6895),l=a(4006),E=a(1697),Q=a(7110),h=a(1390),e=a(4650);class y{constructor(){}ngOnInit(){}}y.\u0275fac=function(t){return new(t||y)},y.\u0275cmp=e.Xpm({type:y,selectors:[["app-note"]],decls:1,vars:0,template:function(t,i){1&t&&e._UZ(0,"router-outlet")},dependencies:[h.lC]});var I=a(4467),F=a(5412),S=a(7185),J=a(2893);class f{constructor(t,i,o,r,c){this._note=t,this.dialog=i,this.toastr=o,this.router=r,this.route=c,this.subscriptions=[],this.handleDelete=d=>this.subscriptions.push(this._note.delete(d).subscribe({error:u=>this.toastr.error(u.error.body.Message,u.error.message),complete:()=>this.getAll()}))}ngOnInit(){this.tableColumns=[{columnDef:"id",header:"#",cell:t=>`${t.id}`},{columnDef:"name",header:"\u0627\u0644\u0623\u0633\u0645",cell:t=>`${t.name}`},{columnDef:"teacher",header:"\u0627\u0644\u0645\u062f\u0631\u0633",cell:t=>`${t.client}`},{columnDef:"term",header:"\u0627\u0644\u062a\u0631\u0645",cell:t=>`${t.term}`},{columnDef:"stage",header:"\u0627\u0644\u0645\u0631\u062d\u0644\u0629",cell:t=>`${t.stage}`},{columnDef:"actualPrice",header:"\u0627\u0644\u0633\u0639\u0631 \u0627\u0644\u0641\u0639\u0644\u064a",cell:t=>`${t.actualPrice}`},{columnDef:"originalPrice",header:"\u0633\u0639\u0631 \u0627\u0644\u062a\u0643\u0644\u0641\u0629",cell:t=>`${t.originalPrice}`},{columnDef:"earning",header:"\u0627\u0644\u0631\u0628\u062d",cell:t=>`${t.earning}`},{columnDef:"teacherPrice",header:"\u0631\u0628\u062d \u0627\u0644\u0645\u062f\u0631\u0633",cell:t=>`${t.teacherPrice}`},{columnDef:"finalPrice",header:"\u0627\u0644\u0633\u0639\u0631 \u0627\u0644\u0646\u0647\u0627\u0626\u064a",cell:t=>`${t.finalPrice}`},{columnDef:"quantity",header:"\u0627\u0644\u0643\u0645\u064a\u0629",cell:t=>`${t.quantity}`}],this.getAll()}getAll(){this.loading=!0,this.subscriptions.push(this._note.getAll().subscribe({next:t=>{t.body?this.tableData=t.body:this.toastr.error(t.message)},error:t=>{this.toastr.error(t.error.body.Message,t.error.message),this.loading=!1},complete:()=>{this.loading=!1}}))}handleView(t){this.router.navigate(["../details"],{queryParams:{id:t.id},relativeTo:this.route})}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe())}}f.\u0275fac=function(t){return new(t||f)(e.Y36(I.Y),e.Y36(F.uw),e.Y36(S._W),e.Y36(h.F0),e.Y36(h.gz))},f.\u0275cmp=e.Xpm({type:f,selectors:[["app-all"]],decls:4,vars:3,consts:[[1,"container","mt-4","text-center"],["dialogHeader","\u062d\u0630\u0641 \u0627\u0644\u0645\u0630\u0643\u0631\u0629","dialogDisplayName","name",3,"loading","tableColumns","tableData","OnDelete"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"p"),e._uU(2,"\u062c\u0645\u064a\u0639 \u0627\u0644\u0623\u0633\u0639\u0627\u0631 \u0627\u0644\u0645\u0648\u0636\u062d\u0629 \u0628\u0627\u0644\u062c\u062f\u0648\u0644 \u062a\u0645 \u062d\u0633\u0627\u0628\u0647\u0627 \u0628\u0627\u0644\u0646\u0633\u0628\u0629 \u0644\u0644\u0645\u0630\u0643\u0631\u0629 \u0627\u0644\u0648\u0627\u062d\u062f\u0629"),e.qZA()(),e.TgZ(3,"app-table",1),e.NdJ("OnDelete",function(r){return i.handleDelete(r)}),e.qZA()),2&t&&(e.xp6(3),e.Q6J("loading",i.loading)("tableColumns",i.tableColumns)("tableData",i.tableData))},dependencies:[J.a]});var O=a(5861),_=a(8675),Y=a(4004),V=a(4482),$=a(5403),w=a(9648),G=a(8653),j=a(7843),L=a(8967),D=a(9549),W=a(7392),z=a(4144),B=a(4385),X=a(3238),x=a(4859),U=a(3805);function H(n,t){1&n&&(e.TgZ(0,"h2",31),e._uU(1,"\u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u0645\u0630\u0643\u0631\u0629"),e.qZA())}function K(n,t){1&n&&(e.TgZ(0,"h2",31),e._uU(1,"\u0645\u0630\u0643\u0631\u0629 \u062c\u062f\u064a\u062f\u0629"),e.qZA())}function R(n,t){if(1&n&&(e.TgZ(0,"mat-option",32),e._uU(1),e.qZA()),2&n){const i=t.$implicit;e.Q6J("value",i.clientTypeId),e.xp6(1),e.Oqu(i.name)}}function k(n,t){if(1&n&&(e.TgZ(0,"mat-option",32),e._uU(1),e.qZA()),2&n){const i=t.$implicit;e.Q6J("value",i.id),e.xp6(1),e.hij(" ",i.name," ")}}function ee(n,t){1&n&&(e.TgZ(0,"mat-error"),e._uU(1,"\u0623\u0633\u0645 \u0627\u0644\u0639\u0645\u064a\u0644 \u063a\u064a\u0631 \u0635\u062d\u064a\u062d"),e.qZA())}function te(n,t){1&n&&(e.TgZ(0,"mat-error"),e._uU(1," \u064a\u062c\u0628 \u0627\u062f\u062e\u0627\u0644 \u0627\u0633\u0645 \u0627\u0644\u0639\u0645\u064a\u0644 "),e.qZA())}function ie(n,t){if(1&n&&(e.TgZ(0,"mat-option",32),e._uU(1),e.qZA()),2&n){const i=t.$implicit;e.Q6J("value",i.id),e.xp6(1),e.Oqu(i.name)}}function ne(n,t){if(1&n&&(e.TgZ(0,"mat-option",32),e._uU(1),e.qZA()),2&n){const i=t.$implicit;e.Q6J("value",i.id),e.xp6(1),e.Oqu(i.name)}}function oe(n,t){if(1&n&&(e.TgZ(0,"mat-option",32),e._uU(1),e.qZA()),2&n){const i=t.$implicit;e.Q6J("value",i.id),e.xp6(1),e.Oqu(i.name)}}function re(n,t){if(1&n&&(e.TgZ(0,"mat-form-field",38)(1,"mat-label"),e._uU(2,"\u0627\u0644\u062e\u062f\u0645\u0627\u062a"),e.qZA(),e.TgZ(3,"mat-select",41),e.YNc(4,oe,2,2,"mat-option",7),e.qZA()()),2&n){const i=e.oxw(3);e.xp6(4),e.Q6J("ngForOf",i.ServicesDataSource)}}function se(n,t){if(1&n&&(e.TgZ(0,"mat-form-field",38)(1,"mat-label"),e._uU(2,"\u0627\u0644\u062e\u062f\u0645\u0627\u062a"),e.qZA(),e._UZ(3,"input",42),e.qZA()),2&n){const i=e.oxw().index,o=e.oxw(2);e.xp6(3),e.Q6J("value",o.getServiceName(i))}}function ae(n,t){if(1&n){const i=e.EpF();e.TgZ(0,"div",4),e.ynx(1,35),e.TgZ(2,"div",14),e.YNc(3,re,5,1,"mat-form-field",36),e.YNc(4,se,4,1,"ng-template",null,37,e.W1O),e.qZA(),e.TgZ(6,"div",17)(7,"mat-form-field",38)(8,"mat-label"),e._uU(9,"\u0627\u0644\u0633\u0639\u0631"),e.qZA(),e._UZ(10,"input",39),e.qZA()(),e.TgZ(11,"div",19)(12,"mat-form-field",38)(13,"mat-label"),e._uU(14,"\u0627\u0644\u0643\u0645\u064a\u0629"),e.qZA(),e._UZ(15,"input",20),e.qZA()(),e.TgZ(16,"div",21)(17,"button",40),e.NdJ("click",function(){const c=e.CHM(i).index,d=e.oxw(2);return e.KtG(d.handleDeleteNoteComponent(c))}),e.TgZ(18,"mat-icon"),e._uU(19,"delete"),e.qZA()()(),e.BQk(),e.qZA()}if(2&n){const i=t.$implicit,o=t.index,r=e.MAs(5);e.xp6(1),e.Q6J("formGroupName",o),e.xp6(2),e.Q6J("ngIf",!i.value.id)("ngIfElse",r)}}function ue(n,t){if(1&n&&(e.TgZ(0,"div",33),e.YNc(1,ae,20,3,"div",34),e.qZA()),2&n){const i=e.oxw();e.xp6(1),e.Q6J("ngForOf",i.noteComponents.controls)}}class v{constructor(t,i,o,r,c,d,u,me,de){this.router=t,this.route=i,this._note=o,this.fb=r,this.toastr=c,this._client=d,this._clientType=u,this._service=me,this._servicePrice=de,this.subscriptions=[],this.loading=!1,this.clientTembId=null,this.controllerName="notes",this.isSubmitted=!1,this.NoteComponentsDataSource=[],this.TermsDataSource=[],this.StagesDataSource=[],this.ClientsDataSource=[],this.ClientTypesDataSource=[],this.ServicesDataSource=[],this.deletedComponents=[],this.getNoteComponentId=s=>this.noteComponents.at(s).get("id"),this.getNoteComponentServiceId=s=>this.noteComponents.at(s).get("serviceId"),this.servicePriceFormControl=s=>this.noteComponents.at(s).get("price"),this.serviceOriginalPriceFormControl=s=>this.noteComponents.at(s).get("originalPrice"),this.serviceQuantityFormControl=s=>this.noteComponents.at(s).get("quantity"),this.filterClients=s=>this.ClientsDataSource.filter(m=>m.name.includes(s)),this.clientDisplayFn=s=>this.ClientsDataSource.find(m=>m.id===s)?.name??"",this.handleNewNoteComponent=()=>{let s=this.noteComponents.length;this.noteComponents.push(this.createFormItem("noteComponent")),this.subscribeQuantityChanges(s),this.subscribeServiceChanges(s)},this.handleDeleteNoteComponent=s=>{this.id&&this.deletedComponents.push(this.getNoteComponentId(s).value);let m=this.serviceQuantityFormControl(s).value;this.setOriginalAndActualPrices(-1,s,m),this.calculateFinalPriceAndEarning(),this.noteComponents.removeAt(s),this.noteComponents.length||(this.originalPrice.setValue(0),this.actualPrice.setValue(0),this.earning.setValue(0),this.finalPrice.setValue(0))},this.getServiceName=s=>this.ServicesDataSource.find(m=>m.id===this.getNoteComponentServiceId(s).value)?.name??"",this.getTerms=()=>this.subscriptions.push(this._note.getTerms().subscribe(s=>{this.TermsDataSource=s,this.TermsDataSource.unshift({id:null,name:"\u0628\u062f\u0648\u0646"})})),this.getSTages=()=>this.subscriptions.push(this._note.getStages().subscribe(s=>{this.StagesDataSource=s,this.StagesDataSource.unshift({id:null,name:"\u0628\u062f\u0648\u0646"})})),this.getSingle=s=>{this.subscriptions.push(this._note.getOne(s).subscribe({next:m=>{let g=m.body;g.noteComponents.forEach(Z=>{this.noteComponents.push(this.createFormItem("noteComponent")),this._servicePrice.getPrice(g.clientTypeId,Z.serviceId).subscribe({next:P=>{this.servicePriceFormControl(g.noteComponents.indexOf(Z)).setValue(P.price),this.serviceOriginalPriceFormControl(g.noteComponents.indexOf(Z)).setValue(P.originalPrice)},error:P=>this.toastr.error(P.error.Message,"\u0644\u0627\u064a\u0645\u0643\u0646 \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u0623\u0633\u0639\u0627\u0631 "),complete:()=>{this.subscribeQuantityChanges(g.noteComponents.indexOf(Z)),this.subscribeServiceChanges(g.noteComponents.indexOf(Z))}})}),this.Form.patchValue(g),this.clientTembId=g.clientId},error:m=>this.toastr.error(m.error.body.Message,m.error.message)}))},this.back=()=>this.router.navigate([this.controllerName]),this.ngOnDestroy=()=>this.subscriptions.forEach(s=>s.unsubscribe()),this.Form=this.createFormItem("init")}get noteId(){return this.Form.get("id")}get noteComponents(){return this.Form.get("noteComponents")}get clientTypeId(){return this.Form.get("clientTypeId")}get clientId(){return this.Form.get("clientId")}get originalPrice(){return this.Form.get("originalPrice")}get teacherPrice(){return this.Form.get("teacherPrice")}get actualPrice(){return this.Form.get("actualPrice")}get earning(){return this.Form.get("earning")}get finalPrice(){return this.Form.get("finalPrice")}ngOnInit(){this.getAllClientTypes(),this.getTerms(),this.getSTages(),this.getAllServices(),this.subscriptions.push(this.clientTypeId.valueChanges.pipe((0,_.O)(this.clientTypeId.value)).subscribe(t=>this.handleClientTypeChange(t))),this.clientsFilteredOptions=this.clientId.valueChanges.pipe((0,_.O)(this.clientId.value),(0,Y.U)(t=>{let o,i=[];return"string"==typeof t&&(o=t),o?(i=this.filterClients(o),i.length?i:(this.clientId.setErrors({notFound:!0}),this.ClientsDataSource.slice())):[]})),this.subscriptions.push(this.teacherPrice.valueChanges.subscribe(t=>this.finalPrice.setValue(+this.actualPrice.value+ +t))),this.subscriptions.push(this.route.queryParams.subscribe(t=>{this.id=t.id,this.id&&this.getSingle(this.id)}))}createFormItem(t){let i=this.fb.group({});switch(t){case"init":i=this.fb.group({id:[0],name:["",[l.kI.required]],originalPrice:[0],earning:[0],actualPrice:[0],teacherPrice:[0,[l.kI.required,l.kI.min(0)]],finalPrice:[0],clientTypeId:[null],clientId:[null,[l.kI.required]],termId:[null],stageId:[null],noteComponents:this.fb.array([]),quantity:[0]});break;case"noteComponent":i=this.fb.group({id:[0],noteId:[this.noteId.value],serviceId:[null,[l.kI.required]],quantity:[1,[l.kI.required,l.kI.min(1)]],price:[0],originalPrice:[0]})}return i}subscribeQuantityChanges(t){this.subscriptions.push(this.serviceQuantityFormControl(t).valueChanges.pipe((0,_.O)(this.serviceQuantityFormControl(t).value),function M(){return(0,V.e)((n,t)=>{let i,o=!1;n.subscribe((0,$.x)(t,r=>{const c=i;i=r,o&&t.next([c,r]),o=!0}))})}()).subscribe(([i,o])=>{this.setOriginalAndActualPrices(1,t,o-i),this.calculateFinalPriceAndEarning()}))}subscribeServiceChanges(t){this.subscriptions.push(this.getNoteComponentServiceId(t).valueChanges.subscribe(i=>{let o=this.serviceQuantityFormControl(t).value;this.subscriptions.push(this._servicePrice.getPrice(this.clientTypeId.value,i).subscribe({next:r=>{this.setOriginalAndActualPrices(-1,t,o),this.serviceOriginalPriceFormControl(t).setValue(r.originalPrice),this.servicePriceFormControl(t).setValue(r.price),this.setOriginalAndActualPrices(1,t,o),this.calculateFinalPriceAndEarning()},error:r=>this.toastr.error(r.message,"\u0644\u0627\u064a\u0645\u0643\u0646 \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u0623\u0633\u0639\u0627\u0631 ")}))}))}getAllServices(){this.subscriptions.push(this._service.getAll().subscribe({next:t=>this.ServicesDataSource=t,error:t=>this.toastr.error(t.message,"\u0644\u0627\u064a\u0645\u0643\u0646 \u062a\u062d\u0645\u064a\u0644 \u0627\u0628\u064a\u0627\u0646\u0627\u062a ")}))}getAllClientTypes(){this.subscriptions.push(this._clientType.getAll().subscribe({next:t=>{this.ClientTypesDataSource=t.map(i=>({clientTypeId:i.id,name:i.name}))},error:t=>{this.toastr.error(t.message,"\u0644\u0627\u064a\u0645\u0643\u0646 \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a ")}}))}handleClientTypeChange(t){null!==t&&this.subscriptions.push(this._client.getAllByType(t).subscribe({next:i=>{this.ClientsDataSource=i},error:i=>{this.ClientsDataSource=[],this.clientId.reset(),this.toastr.error(i.message,"\u0644\u0627\u064a\u0645\u0643\u0646 \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a ")},complete:()=>{this.clientTembId?(this.clientId.setValue(this.clientTembId),this.clientTembId=null):this.clientId.reset(),this.calculateNotePrice()}}))}setOriginalAndActualPrices(t,i,o){this.originalPrice.setValue(+this.originalPrice.value+t*(+this.serviceOriginalPriceFormControl(i).value*o)),this.actualPrice.setValue(+this.actualPrice.value+t*(+this.servicePriceFormControl(i).value*o))}calculateFinalPriceAndEarning(){this.earning.setValue(+this.actualPrice.value-+this.originalPrice.value),this.finalPrice.setValue(+this.actualPrice.value+ +this.teacherPrice.value)}calculateNotePrice(){var t=this;return(0,O.Z)(function*(){let i=0,o=0;if(!t.noteComponents.length)return t.originalPrice.setValue(0),t.actualPrice.setValue(0),t.earning.setValue(0),void t.finalPrice.setValue(0);for(let r=0;r<t.noteComponents.length;r++)if(t.getNoteComponentServiceId(r).value){let c=yield new Promise(d=>{t._servicePrice.getPrice(t.clientTypeId.value,t.getNoteComponentServiceId(r).value).subscribe({next:u=>d({price:u.price,originalPrice:u.originalPrice}),error:u=>t.toastr.error(u.message,"\u0644\u0627\u064a\u0645\u0643\u0646 \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u0623\u0633\u0639\u0627\u0631 ")})});i+=c.price*t.serviceQuantityFormControl(r).value,o+=c.originalPrice*t.serviceQuantityFormControl(r).value,t.servicePriceFormControl(r).setValue(c.price),t.serviceOriginalPriceFormControl(r).setValue(c.originalPrice)}else t.servicePriceFormControl(r).setValue(0),t.serviceOriginalPriceFormControl(r).setValue(0);t.originalPrice.setValue(o),t.actualPrice.setValue(i),t.calculateFinalPriceAndEarning()})()}handleSubmit(){this.Form.valid&&(this.loading=!0,this.id?this.update():this.add())}update(){this.deletedComponents.length&&this.subscriptions.push(this._note.deleteNoteComponents(this.deletedComponents).subscribe({error:t=>{this.loading=!1,this.toastr.error((t.error??t).message)}})),this.subscriptions.push(this._note.update(this.id,this.Form.value).subscribe({next:t=>{this.isSubmitted=!0,this.loading=!0,this.back()},error:t=>{this.loading=!1,this.toastr.error((t.error??t).message)},complete:()=>this.loading=!1}))}add(){this.subscriptions.push(this._note.add(this.Form.value).subscribe({next:t=>{this.isSubmitted=!0,this.loading=!0,this.back()},error:t=>{this.loading=!1,this.toastr.error((t.error??t).message)},complete:()=>this.loading=!1}))}}v.\u0275fac=function(t){return new(t||v)(e.Y36(h.F0),e.Y36(h.gz),e.Y36(I.Y),e.Y36(l.qu),e.Y36(S._W),e.Y36(w.y),e.Y36(G.q),e.Y36(j.r),e.Y36(L.c))},v.\u0275cmp=e.Xpm({type:v,selectors:[["app-add-edit"]],decls:78,vars:22,consts:[["class","w-100 text-center mt-3",4,"ngIf","ngIfElse"],["update",""],[1,"container"],[1,"d-flex","flex-column",3,"formGroup","ngSubmit"],[1,"row"],["appearance","fill",1,"col-3"],["formControlName","clientTypeId"],[3,"value",4,"ngFor","ngForOf"],["type","text","matInput","","formControlName","clientId",3,"matAutocomplete"],[3,"displayWith"],["clientAuto","matAutocomplete"],[4,"ngIf"],["formControlName","stageId"],["formControlName","termId"],[1,"col-6"],[1,"w-100"],["type","text","matInput","","formControlName","name"],[1,"col-3"],["type","number","min","0","matInput","","formControlName","teacherPrice"],[1,"col-2"],["type","number","min","0","matInput","","formControlName","quantity"],[1,"col-1"],["type","button","mat-icon-button","","matTooltip","add","color","basic","aria-label","add note component row",3,"disabled","click"],["formArrayName","noteComponents",4,"ngIf"],["type","number","matInput","","formControlName","actualPrice",3,"readonly"],["type","number","matInput","","formControlName","originalPrice",3,"readonly"],["type","number","matInput","","formControlName","earning",3,"readonly"],["type","number","matInput","","formControlName","finalPrice",3,"readonly"],[1,"my-2","d-flex","flex-row-reverse"],["mat-flat-button","","color","warn",1,"mx-2","px-4",3,"disabled"],["type","button","mat-stroked-button","","color","basic",3,"disabled","click"],[1,"w-100","text-center","mt-3"],[3,"value"],["formArrayName","noteComponents"],["class","row",4,"ngFor","ngForOf"],[3,"formGroupName"],["appearance","fill","class","w-100",4,"ngIf","ngIfElse"],["disabled",""],["appearance","fill",1,"w-100"],["type","number","matInput","","formControlName","price","readonly","true"],["type","button","mat-icon-button","","matTooltip","delete","color","warn","aria-label","delete selected row",3,"click"],["formControlName","serviceId"],["type","text","matInput","","readonly","true",3,"value"]],template:function(t,i){if(1&t&&(e.YNc(0,H,2,0,"h2",0),e.YNc(1,K,2,0,"ng-template",null,1,e.W1O),e.TgZ(3,"section",2)(4,"form",3),e.NdJ("ngSubmit",function(){return i.handleSubmit()}),e.TgZ(5,"div",4)(6,"mat-form-field",5)(7,"mat-label"),e._uU(8,"\u0646\u0648\u0639 \u0627\u0644\u0639\u0645\u064a\u0644"),e.qZA(),e.TgZ(9,"mat-select",6),e.YNc(10,R,2,2,"mat-option",7),e.qZA()(),e.TgZ(11,"mat-form-field",5)(12,"mat-label"),e._uU(13,"\u0623\u0633\u0645 \u0627\u0644\u0639\u0645\u064a\u0644"),e.qZA(),e._UZ(14,"input",8),e.TgZ(15,"mat-autocomplete",9,10),e.YNc(17,k,2,2,"mat-option",7),e.ALo(18,"async"),e.qZA(),e.YNc(19,ee,2,0,"mat-error",11),e.YNc(20,te,2,0,"mat-error",11),e.qZA(),e.TgZ(21,"mat-form-field",5)(22,"mat-label"),e._uU(23,"\u0627\u0644\u0645\u0631\u062d\u0644\u0629"),e.qZA(),e.TgZ(24,"mat-select",12),e.YNc(25,ie,2,2,"mat-option",7),e.qZA()(),e.TgZ(26,"mat-form-field",5)(27,"mat-label"),e._uU(28,"\u0627\u0644\u062a\u0631\u0645"),e.qZA(),e.TgZ(29,"mat-select",13),e.YNc(30,ne,2,2,"mat-option",7),e.qZA()()(),e.TgZ(31,"div",4)(32,"div",14)(33,"mat-form-field",15)(34,"mat-label"),e._uU(35,"\u0623\u0633\u0645 \u0627\u0644\u0645\u0630\u0643\u0631\u0629"),e.qZA(),e._UZ(36,"input",16),e.qZA()(),e.TgZ(37,"div",17)(38,"mat-form-field",15)(39,"mat-label"),e._uU(40,"\u0647\u0627\u0645\u0634 \u0631\u0628\u062d \u0627\u0644\u0645\u062f\u0631\u0633"),e.qZA(),e._UZ(41,"input",18),e.qZA()(),e.TgZ(42,"div",19)(43,"mat-form-field",15)(44,"mat-label"),e._uU(45,"\u0627\u0644\u0643\u0645\u064a\u0629"),e.qZA(),e._UZ(46,"input",20),e.qZA()(),e.TgZ(47,"div",21)(48,"button",22),e.NdJ("click",function(){return i.handleNewNoteComponent()}),e.TgZ(49,"mat-icon"),e._uU(50,"add"),e.qZA()()()(),e.YNc(51,ue,2,1,"div",23),e.TgZ(52,"div",4)(53,"div",17)(54,"mat-form-field",15)(55,"mat-label"),e._uU(56,"\u0627\u0644\u0633\u0639\u0631 \u0627\u0644\u0641\u0639\u0644\u064a"),e.qZA(),e._UZ(57,"input",24),e.qZA()(),e.TgZ(58,"div",17)(59,"mat-form-field",15)(60,"mat-label"),e._uU(61,"\u0627\u0644\u0633\u0639\u0631 \u0627\u0644\u062a\u0643\u0644\u0641\u0629"),e.qZA(),e._UZ(62,"input",25),e.qZA()(),e.TgZ(63,"div",17)(64,"mat-form-field",15)(65,"mat-label"),e._uU(66,"\u0647\u0627\u0645\u0634 \u0627\u0644\u0631\u0628\u062d"),e.qZA(),e._UZ(67,"input",26),e.qZA()(),e.TgZ(68,"div",17)(69,"mat-form-field",15)(70,"mat-label"),e._uU(71,"\u0627\u0644\u0633\u0639\u0631 \u0627\u0644\u0646\u0647\u0627\u0626\u064a"),e.qZA(),e._UZ(72,"input",27),e.qZA()()(),e.TgZ(73,"div",28)(74,"button",29),e._uU(75),e.qZA(),e.TgZ(76,"button",30),e.NdJ("click",function(){return i.back()}),e._uU(77,"\u0631\u062c\u0648\u0639"),e.qZA()()()()),2&t){const o=e.MAs(2),r=e.MAs(16);e.Q6J("ngIf",i.id)("ngIfElse",o),e.xp6(4),e.Q6J("formGroup",i.Form),e.xp6(6),e.Q6J("ngForOf",i.ClientTypesDataSource),e.xp6(4),e.Q6J("matAutocomplete",r),e.xp6(1),e.Q6J("displayWith",i.clientDisplayFn),e.xp6(2),e.Q6J("ngForOf",e.lcZ(18,20,i.clientsFilteredOptions)),e.xp6(2),e.Q6J("ngIf",i.clientId.hasError("notFound")),e.xp6(1),e.Q6J("ngIf",i.clientId.hasError("required")&&(i.clientId.touched||i.clientId.dirty)),e.xp6(5),e.Q6J("ngForOf",i.StagesDataSource),e.xp6(5),e.Q6J("ngForOf",i.TermsDataSource),e.xp6(18),e.Q6J("disabled",!i.clientId.value||i.clientId.invalid),e.xp6(3),e.Q6J("ngIf",i.noteComponents.controls.length),e.xp6(6),e.Q6J("readonly",!0),e.xp6(5),e.Q6J("readonly",!0),e.xp6(5),e.Q6J("readonly",!0),e.xp6(5),e.Q6J("readonly",!0),e.xp6(2),e.Q6J("disabled",!i.Form.valid||!i.noteComponents.length||i.loading),e.xp6(1),e.Oqu(i.loading?"\u0627\u0646\u062a\u0638\u0631 \u0645\u0646 \u0641\u0636\u0644\u0643":"\u062d\u0641\u0638"),e.xp6(1),e.Q6J("disabled",i.loading)}},dependencies:[l._Y,l.Fj,l.wV,l.JJ,l.JL,l.qQ,l.sg,l.u,l.x0,l.CE,A.sg,A.O5,D.KE,D.hX,D.TO,W.Hw,z.Nt,B.gD,X.ey,x.lW,x.RK,U.XC,U.ZL,A.Ov]});class T{constructor(t,i,o,r,c){this._note=t,this.router=i,this.route=o,this.dialog=r,this.fb=c,this.subscriptions=[],this.controllerName="notes",this.noteComponents=[],this.getSingle=d=>this.subscriptions.push(this._note.getOne(d).subscribe(u=>{this.noteDetails={id:u.id,name:u.name,actualPrice:u.actualPrice,teacherPrice:u.teacherPrice,finalPrice:u.finalPrice,clientId:u.clientId,client:u.client,clientTypeId:u.clientTypeId,clientType:u.clientType,termId:u.termId,term:u.term.name,stageId:u.stageId,stage:u.stage.name,originalPrice:u.originalPrice,earning:u.earning,noteComponents:u.noteComponents,quantity:u.quantity}})),this.back=()=>this.router.navigate([this.controllerName])}ngOnInit(){this.subscriptions.push(this.route.queryParams.subscribe(t=>{this.id=t.id,this.id&&this.getSingle(this.id)}))}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe())}}T.\u0275fac=function(t){return new(t||T)(e.Y36(I.Y),e.Y36(h.F0),e.Y36(h.gz),e.Y36(F.uw),e.Y36(l.qu))},T.\u0275cmp=e.Xpm({type:T,selectors:[["app-details"]],decls:7,vars:6,template:function(t,i){1&t&&(e.TgZ(0,"h1"),e._uU(1,"Note details"),e.qZA(),e._uU(2),e.ALo(3,"json"),e._UZ(4,"br"),e._uU(5),e.ALo(6,"json")),2&t&&(e.xp6(2),e.hij("\n",e.lcZ(3,2,i.noteDetails),"\n"),e.xp6(3),e.hij("\n",e.lcZ(6,4,i.noteComponents),"\n"))},dependencies:[A.Ts]});var le=a(7957);class p{constructor(t){this.dialog=t}canDeactivate(t){var i=this;return(0,O.Z)(function*(){return!!(t.Form.touched&&t.Form.dirty&&t.isSubmitted||t.Form.untouched)||(yield new Promise((r,c)=>{i.dialog.closeAll(),i.dialog.open(le.a,{disableClose:!0,data:{location:"\u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u062a\u0639\u062f\u064a\u0644\u0627\u062a",msg:"\u0644\u0642\u062f \u0642\u0645\u062a \u0628\u062a\u0639\u062f\u064a\u0644 \u0628\u0639\u0636 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a \u0648\u0644\u0645 \u062a\u0642\u0645 \u0628\u062d\u0641\u0638\u0647\u0627,\u0647\u0644 \u0627\u0646\u062a \u0645\u062a\u0627\u0643\u062f \u0645\u0646 \u0645\u063a\u0627\u062f\u0631\u0629 \u0627\u0644\u0635\u0641\u062d\u0629"}}).afterClosed().subscribe({next:d=>r(d),error:d=>c()})}))})()}}p.\u0275fac=function(t){return new(t||p)(e.LFG(F.uw))},p.\u0275prov=e.Yz7({token:p,factory:p.\u0275fac});var q=a(6578);const ce=[{path:"",component:y,title:"\u0627\u0644\u0645\u0630\u0643\u0631\u0627\u062a",canActivateChild:[q.i],children:[{path:"all",component:f,title:"\u062c\u0645\u064a\u0639 \u0627\u0644\u0645\u0630\u0643\u0631\u0627\u062a"},{path:"allByTeacherId",component:f,title:"\u062c\u0645\u064a\u0639 \u0627\u0644\u0645\u0630\u0643\u0631\u0627\u062a \u0644\u0644\u0645\u062f\u0631\u0633"},{path:"new",component:v,title:"\u0623\u0636\u0627\u0641\u0629 \u0645\u0630\u0643\u0631\u0629 \u062c\u062f\u064a\u062f\u0629",canDeactivate:[p]},{path:"edit",component:v,title:"\u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u0645\u0630\u0643\u0631\u0629",canDeactivate:[p]},{path:"details",component:T,title:"\u062a\u0641\u0627\u0635\u064a\u0644 \u0627\u0644\u0645\u0630\u0643\u0631\u0629"},{path:"",redirectTo:"all",pathMatch:"full"}]}];class C{}C.\u0275fac=function(t){return new(t||C)},C.\u0275mod=e.oAB({type:C}),C.\u0275inj=e.cJS({imports:[h.Bz.forChild(ce),h.Bz]});class b{}b.\u0275fac=function(t){return new(t||b)},b.\u0275mod=e.oAB({type:b}),b.\u0275inj=e.cJS({providers:[q.i,I.Y,p],imports:[l.u5,l.UX,A.ez,C,Q.SharedModule,E.I]})}}]);