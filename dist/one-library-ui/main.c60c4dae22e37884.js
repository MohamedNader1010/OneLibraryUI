"use strict";(self.webpackChunkOneLibraryUI=self.webpackChunkOneLibraryUI||[]).push([[179],{6578:(v,f,t)=>{t.d(f,{i:()=>a});var i=t(5861),s=t(3175),p=t(9808),h=t(4650),S=t(1390),d=t(2746);class a{constructor(e,o){this._router=e,this._auth=o,this.jwtHelper=new s.N0}canActivateChild(e,o){var l=this;return(0,i.Z)(function*(){return l.Auth(o)})()}canActivate(e,o){var l=this;return(0,i.Z)(function*(){return l.Auth(o)})()}canLoad(){var e=this;return(0,i.Z)(function*(){return e.Auth()})()}Auth(e=null){var o=this;return(0,i.Z)(function*(){const l=localStorage.getItem("token");return!!(l&&!o.jwtHelper.isTokenExpired(l)||l)||((yield o.refreshingTokens(l))||o._router.createUrlTree(["/auth/login",{returnUrl:e?.url}]))})()}refreshingTokens(e){var o=this;return(0,i.Z)(function*(){const l=localStorage.getItem("refreshToken");if(!e||!l)return!1;let c=!1;try{const I=yield(0,p.n)(o._auth.refreshToken());I&&o._auth.setLocalStorage(I.body),c=!0}catch{c=!1,o._auth.clearLocalStorage(),o._auth.username.next(null)}return c})()}}a.\u0275fac=function(e){return new(e||a)(h.LFG(S.F0),h.LFG(d.e))},a.\u0275prov=h.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"})},2746:(v,f,t)=>{t.d(f,{e:()=>a});var i=t(1135),s=t(3151),p=t(2340),h=t(4650),S=t(1390),d=t(529);class a{constructor(e,o){this.router=e,this.http=o,this.isLogged=!!localStorage.getItem("token"),this.username=new i.X(null),this.uri=`${p.N.apiUrl}Authorzation/`,this.isLogged=!!localStorage.getItem("token")}login(e){return this.http.post(`${this.uri}LogIn`,e).pipe((0,s.d)())}forgetPassword(e){return this.http.post(`${this.uri}ForgetPassword?email=${e}`,null)}resetPassword(e){return this.http.post(`${this.uri}ResetPassword`,e)}changePassword(e,o){return this.http.put(`${this.uri}changePassword?id=${e}`,o)}confirmEmail(e,o){return this.http.get(`${this.uri}confirmEmail`,{params:{userid:e,token:o}})}getUserById(e){return this.http.get(`${this.uri}Profile`,{params:{id:e}})}UpdateUser(e,o){return this.http.put(`${this.uri}?id=${e}`,o)}refreshToken(){return this.http.post(`${this.uri}refreshToken`,{token:localStorage.getItem("refreshToken")})}setLocalStorage(e){localStorage.setItem("token",e.token),localStorage.setItem("refreshToken",e.refreshToken),localStorage.setItem("refreshTokenExp",e.refreshTokenExpiration.toString()),localStorage.setItem("uname",e.username),localStorage.setItem("uid",e.id),localStorage.setItem("iSCheckedIn",e.isCheckedIn.toString())}clearLocalStorage(){localStorage.clear()}logout(){this.clearLocalStorage(),this.router.navigate(["/auth/login"])}}a.\u0275fac=function(e){return new(e||a)(h.LFG(S.F0),h.LFG(d.eN))},a.\u0275prov=h.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"})},2340:(v,f,t)=>{t.d(f,{N:()=>s});let i="http://192.168.1.111:991/";const s={production:!0,apiUrl:`${i}api/`,host:i}},786:(v,f,t)=>{var i=t(1481),s=t(4650),p=t(6578),h=t(1390);const S=[{path:"auth",loadChildren:()=>Promise.all([t.e(786),t.e(592),t.e(420)]).then(t.bind(t,8420)).then(n=>n.AuthModule)},{path:"",loadChildren:()=>Promise.all([t.e(786),t.e(890)]).then(t.bind(t,8890)).then(n=>n.SharedModule),canLoad:[p.i]}];class d{}d.\u0275fac=function(r){return new(r||d)},d.\u0275mod=s.oAB({type:d}),d.\u0275inj=s.cJS({imports:[h.Bz.forRoot(S),h.Bz]});var a=t(9383),T=t(2746);class e{constructor(r){this.authService=r,this.timeoutId=null,this.resetTimer=()=>{clearTimeout(this.timeoutId),this.startTimeout()},this.startTimeout=()=>{this.timeoutId=setTimeout(()=>{this.authService.logout()},9e5),this.addListeners()},this.stopTimeout=()=>{this.removeListeners(),clearTimeout(this.timeoutId)}}addListeners(){window.addEventListener("mousemove",this.resetTimer,!0),window.addEventListener("mousedown",this.resetTimer,!0),window.addEventListener("keypress",this.resetTimer,!0),window.addEventListener("touchmove",this.resetTimer,!0)}removeListeners(){window.removeEventListener("mousemove",this.resetTimer,!0),window.removeEventListener("mousedown",this.resetTimer,!0),window.removeEventListener("keypress",this.resetTimer,!0),window.removeEventListener("touchmove",this.resetTimer,!0)}}e.\u0275fac=function(r){return new(r||e)(s.LFG(T.e))},e.\u0275prov=s.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"});class o{constructor(r,m){this.translate=r,this.sessionTimeoutService=m,this.title="OneLibraryUI",r.setDefaultLang("en"),r.use("en")}ngOnInit(){this.sessionTimeoutService.startTimeout()}ngOnDestroy(){this.sessionTimeoutService.stopTimeout()}}o.\u0275fac=function(r){return new(r||o)(s.Y36(a.sK),s.Y36(e))},o.\u0275cmp=s.Xpm({type:o,selectors:[["app-root"]],decls:1,vars:0,template:function(r,m){1&r&&s._UZ(0,"router-outlet")},dependencies:[h.lC]});var l=t(6895),c=t(529),I=t(1135),P=t(262),A=t(2843),y=t(3900),D=t(9300),R=t(5698),O=t(7185);class L{constructor(r,m,u){this._auth=r,this.router=m,this.toastr=u,this.isRefreshing=!1,this.refreshTokenSubject=new I.X(null)}intercept(r,m){r=r.clone({headers:r.headers.set("Content-Type","application/json")});let u=localStorage.getItem("token");return u&&(r=r.clone({headers:r.headers.set("Authorization",`Bearer ${u}`)})),m.handle(r).pipe((0,P.K)(g=>g instanceof c.UA&&401===g.status?this.handle401Error(r,m):(0,A._)(()=>g)))}handle401Error(r,m){return this.isRefreshing?this.refreshTokenSubject.pipe((0,D.h)(u=>null!=u),(0,R.q)(1),(0,y.w)(u=>m.handle(r.clone({setHeaders:{Authorization:u}})))):(this.isRefreshing=!0,this.refreshTokenSubject.next(null),this._auth.refreshToken().pipe((0,P.K)(u=>(this.toastr.error(u.message),this._auth.clearLocalStorage(),this._auth.username.next(null),this.refreshTokenSubject.next(null),this.router.navigate(["/auth/login"],{queryParams:{returnUrl:this.router.url},queryParamsHandling:"merge"}),(0,A._)(()=>u))),(0,y.w)(u=>{if(this.isRefreshing=!1,u){let g=u.body;this._auth.setLocalStorage(g),this._auth.username.next(g.username),this.refreshTokenSubject.next(g.token)}else this._auth.clearLocalStorage(),this._auth.username.next(null),this.refreshTokenSubject.next(null),this.router.navigate(["/auth/login",{queryParams:{returnUrl:this.router.routerState.snapshot.url}}]);return m.handle(r.clone({setHeaders:{Authorization:`Bearer ${u.body.token}`}}))})))}}L.\u0275fac=function(r){return new(r||L)(s.LFG(T.e),s.LFG(h.F0),s.LFG(O._W))},L.\u0275prov=s.Yz7({token:L,factory:L.\u0275fac});var U=t(1516),C=t(3175),M=t(2340),F=t(9832);class E{}E.\u0275fac=function(r){return new(r||E)},E.\u0275mod=s.oAB({type:E,bootstrap:[o]}),E.\u0275inj=s.cJS({providers:[p.i,{provide:c.TP,useClass:L,multi:!0}],imports:[i.b2,c.JF,d,l.ez,C.Ar.forRoot({config:{tokenGetter:function B(){return localStorage.getItem("token")},allowedDomains:[M.N.host],disallowedRoutes:[]}}),O.Rh.forRoot({preventDuplicates:!0,positionClass:"toast-bottom-left",progressBar:!0,newestOnTop:!0,progressAnimation:"decreasing"}),U.PW,a.aw.forRoot({defaultLanguage:"en",loader:{provide:a.Zw,useFactory:function x(n){return new F.w(n,"./assets/i18n/",".json")},deps:[c.eN]}})]}),M.N.production&&(0,s.G48)(),i.q6().bootstrapModule(E).catch(n=>console.error(n))}},v=>{v.O(0,[736],()=>v(v.s=786)),v.O()}]);