<h2 class="w-100 text-center mt-3" *ngIf="id; else update">تعديل الطلب</h2>
<ng-template #update>
	<h2 class="w-100 text-center mt-3">طلب جديد</h2>
</ng-template>
<section class="container">
	<form [formGroup]="Form" (ngSubmit)="handleSubmit()" class="d-flex flex-column">
		<div class="row">
			<mat-form-field appearance="fill" class="col-4">
				<mat-label>نوع العميل</mat-label>
				<mat-select (selectionChange)="changeClientType($event)">
					<mat-option *ngFor="let mat of ClientTypesDataSource" [value]="mat.id">{{ mat.name }}</mat-option>
				</mat-select>
			</mat-form-field>
			<mat-form-field appearance="fill" class="col-7">
				<mat-label>العميل</mat-label>
				<mat-select formControlName="clientId">
					<mat-option *ngFor="let mat of ClientsDataSource" [value]="mat.id">{{ mat.name }}</mat-option>
				</mat-select>
			</mat-form-field>
			<div class="col-1">
				<button type="button" mat-icon-button matTooltip="add" color="primary" aria-label="add order detail row" (click)="handleNewDetail()">
					<mat-icon>add</mat-icon>
				</button>
			</div>
		</div>
		<!-- order details -->
		<div formArrayName="details" *ngIf="OrderDetails.controls.length">
			<div class="row" *ngFor="let detail of OrderDetails.controls; let i = index">
				<ng-container [formGroupName]="i">
					<div class="col-3">
						<mat-form-field appearance="fill" class="w-100">
							<mat-label>الخدمات</mat-label>
							<mat-select formControlName="serviceId">
								<mat-option *ngFor="let mat of ServicesDataSource" [value]="mat.id">{{ mat.name }}</mat-option>
							</mat-select>
						</mat-form-field>
					</div>
					<div class="col-3">
						<mat-form-field appearance="fill" class="w-100">
							<mat-label>المذكرات</mat-label>
							<mat-select formControlName="noteId">
								<mat-option *ngFor="let mat of NotesDataSource" [value]="mat.id">{{ mat.name }}</mat-option>
							</mat-select>
						</mat-form-field>
					</div>
					<div class="col-3">
						<mat-form-field appearance="fill" class="w-100">
							<mat-label>الكمية</mat-label>
							<input type="number" matInput formControlName="quantity" />
						</mat-form-field>
					</div>
					<div class="col-2">
						<mat-form-field class="w-100">
							<mat-label>السعر</mat-label>
							<input type="number" matInput formControlName="price" />
						</mat-form-field>
					</div>
					<div class="col-1">
						<button type="button" mat-icon-button matTooltip="delete" color="warn" aria-label="delete selected row" (click)="handleDeleteDetail(i)">
							<mat-icon>delete</mat-icon>
						</button>
					</div>
				</ng-container>
			</div>
		</div>
		<!-- end order details -->
		<div class="row">
			<div class="col-4">
				<mat-form-field class="w-100">
					<mat-label>السعر الاجمالي</mat-label>
					<input type="number" matInput formControlName="totalPrice" />
				</mat-form-field>
			</div>
			<div class="col-4">
				<mat-form-field class="w-100">
					<mat-label>خصم مبلغ</mat-label>
					<input type="number" matInput formControlName="descountAmount" />
				</mat-form-field>
			</div>
			<div class="col-3">
				<mat-form-field class="w-100">
					<mat-label>خصم نسبة</mat-label>
					<input type="number" matInput formControlName="descountPercent" />
				</mat-form-field>
			</div>
		</div>
		<div class="row">
			<div class="col-4">
				<mat-form-field class="w-100">
					<mat-label>السعر النهائي</mat-label>
					<input type="number" matInput formControlName="finalPrice" />
				</mat-form-field>
			</div>
			<div class="col-4">
				<mat-form-field class="w-100">
					<mat-label>المدفوع</mat-label>
					<input type="number" matInput formControlName="paid" />
				</mat-form-field>
			</div>
			<div class="col-3">
				<mat-form-field class="w-100">
					<mat-label>الباقي</mat-label>
					<input type="number" matInput formControlName="rest" />
				</mat-form-field>
			</div>
		</div>
		<div class="row">
			<div class="col-11">
				<mat-form-field class="w-100">
					<mat-label>ملحوظات العميل</mat-label>
					<textarea matInput formControlName="remarks"></textarea>
				</mat-form-field>
			</div>
		</div>
		<div class="my-2 d-flex flex-row-reverse">
			<button mat-flat-button color="warn" class="mx-2 px-4" disabled="{{ !Form.valid }}">حفظ</button>
			<button type="button" mat-stroked-button color="basic" (click)="back()">رجوع</button>
		</div>
	</form>
</section>
